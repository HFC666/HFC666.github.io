<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <meta name="google-site-verification" content="U-yOiB98PNsowxlO4rY3Zc43lFlfBRiIxhp4pQPMRW4" /> 

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="true">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.3.5/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.hfcouc.work","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="B站课程链接：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1av411N7Xi?spm_id_from&#x3D;333.999.0.0&amp;vd_source&#x3D;6177c61c946280bb88c727585de76bc8">
<meta property="og:type" content="article">
<meta property="og:title" content="B站课程Mathematica剩余部分">
<meta property="og:url" content="https://www.hfcouc.work/2022/07/18/math2/index.html">
<meta property="og:site_name" content="独自赏晴雨">
<meta property="og:description" content="B站课程链接：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1av411N7Xi?spm_id_from&#x3D;333.999.0.0&amp;vd_source&#x3D;6177c61c946280bb88c727585de76bc8">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Finews.gtimg.com%2Fnewsapp_bt%2F0%2F13376661231%2F641&refer=http%3A%2F%2Finews.gtimg.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1660719664&t=7a06182fcd2599240cf9b86397be591b">
<meta property="article:published_time" content="2022-07-18T06:58:49.000Z">
<meta property="article:modified_time" content="2022-07-19T06:59:28.798Z">
<meta property="article:author" content="Han Fangcheng">
<meta property="article:tag" content="编程">
<meta property="article:tag" content="Mathematica">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Finews.gtimg.com%2Fnewsapp_bt%2F0%2F13376661231%2F641&refer=http%3A%2F%2Finews.gtimg.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1660719664&t=7a06182fcd2599240cf9b86397be591b">

<link rel="canonical" href="https://www.hfcouc.work/2022/07/18/math2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>B站课程Mathematica剩余部分 | 独自赏晴雨</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

    <script type="text/javascript" src="https://unpkg.com/minigrid@3.1.1/dist/minigrid.min.js"></script>
  <link rel="stylesheet" href="/photos/photos.css">
  <script type="text/javascript" src="/photos/photo.js"></script>
<link rel="alternate" href="/atom.xml" title="独自赏晴雨" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
	<a target="_blank" rel="noopener" href="https://github.com//HFC666" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#70B7FD; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">独自赏晴雨</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-photos">

    <a href="/photos/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>相册</a>

  </li>
        <li class="menu-item menu-item-bangumis">

    <a href="/bangumis" rel="section"><i class="fa fa-headphones fa-fw"></i>追番</a>

  </li>
        <li class="menu-item menu-item-cinemas">

    <a href="/cinemas" rel="section"><i class="fa fa-headphones fa-fw"></i>追剧</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.hfcouc.work/2022/07/18/math2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fb-ssl.duitang.com%2Fuploads%2Fitem%2F201805%2F17%2F20180517161524_3KNca.thumb.700_0.jpeg&refer=http%3A%2F%2Fb-ssl.duitang.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1659264207&t=3d15a378d08a1d4a57e3463cdbe4c159">
      <meta itemprop="name" content="Han Fangcheng">
      <meta itemprop="description" content="当你穿过了暴风雨，你就不再是原来那个人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独自赏晴雨">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          B站课程Mathematica剩余部分
        </h1>

        <div class="post-meta">
		  
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-07-18 14:58:49" itemprop="dateCreated datePublished" datetime="2022-07-18T14:58:49+08:00">2022-07-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-19 14:59:28" itemprop="dateModified" datetime="2022-07-19T14:59:28+08:00">2022-07-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">课程笔记</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p align="center">
    <img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Finews.gtimg.com%2Fnewsapp_bt%2F0%2F13376661231%2F641&refer=http%3A%2F%2Finews.gtimg.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1660719664&t=7a06182fcd2599240cf9b86397be591b" style="zoom: 100%;" />
</p>


<blockquote>
<p> B站课程链接：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1av411N7Xi?spm_id_from=333.999.0.0&amp;vd_source=6177c61c946280bb88c727585de76bc8">https://www.bilibili.com/video/BV1av411N7Xi?spm_id_from=333.999.0.0&amp;vd_source=6177c61c946280bb88c727585de76bc8</a></p>
</blockquote>
<span id="more"></span>
<h2 id="第四周"><a href="#第四周" class="headerlink" title="第四周"></a>第四周</h2><h3 id="重写规则"><a href="#重写规则" class="headerlink" title="重写规则"></a>重写规则</h3><p><code>Mathematica</code>的第二原理：计算即重写。所谓重写，即将匹配成功的模式改为其他形式。Mathematica就是由一大堆重写规则组成的。</p>
<p>重写规则的一般形式是：</p>
<p><code>(模式)    (重写符号)    (重写结果)</code></p>
<p>其中重写符号有四种：<code>-&gt;、:&gt;、=、:=</code>，分别叫做规则、延迟规则、赋值、延迟赋值。重写结果则是一个表达式，它可以依赖重写符号左边被命名的子模式。</p>
<p>规则与延迟规则是一种较为安全的重写机制，因为只有在你应用它们的时候它们才起作用。而赋值和延迟赋值则是添加到系统内部的一种重写规则，一旦添加进去就立刻起作用，并永远存在，除非你手动移除它们(<code>=.、Clear、Remove</code>)。</p>
<p>最常见的规则出现在<code>Solve</code>类函数的返回值中：</p>
<figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">result = Solve[x^<span class="number">3</span> - <span class="number">3</span> x + <span class="number">2</span> == <span class="number">0</span>, x]</span><br><span class="line">&#123;&#123;x -&gt; -<span class="number">2</span>&#125;, &#123;x -&gt; <span class="number">1</span>&#125;, &#123;x -&gt; <span class="number">1</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><code>Solve</code>的结果是不唯一的，<code>Mathematica</code>并不知道我们打算用哪一个，所以只好将它们存储为规则，我们可以从中挑选出我们想要的，然后将它应用在其他地方。</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Expand</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">^</span><span class="number">4</span> <span class="operator">+</span> <span class="variable">x</span><span class="operator">^</span><span class="number">2</span> <span class="operator">+</span> <span class="number">1</span> <span class="operator">/.</span> <span class="variable">result</span><span class="punctuation">[</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="number">21</span></span><br></pre></td></tr></table></figure>
<p>我们也可以不挑选，这样得到一个由不同规则到来的结果构成的表。</p>
<figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Expand[x^<span class="number">4</span> + x^<span class="number">2</span> + <span class="number">1</span> /. result]</span><br><span class="line">&#123;<span class="number">21</span>, <span class="number">3</span>, <span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure>
<p>注意在上述操作时，<code>x</code>并未发生改变。</p>
<p>规则比赋值灵活，因为赋值是定义全局变量。全局变量一旦重命名就很容易造成程序错误。这是<code>Mathematica</code>中最常见的一类错误。为了避免这种错误才有了这种模块化的机制。</p>
<p>规则的左边可以是模式：</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">rule</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="variable">f</span><span class="punctuation">[</span><span class="type">x_</span><span class="punctuation">]</span> <span class="operator">-&gt;</span> <span class="variable">x</span><span class="operator">^</span><span class="number">2</span><span class="punctuation">)</span><span class="operator">;</span></span><br><span class="line"><span class="variable">f</span><span class="punctuation">[</span><span class="number">5</span><span class="punctuation">]</span> <span class="operator">+</span> <span class="variable">g</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">/.</span> <span class="variable">rule</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="number">25</span> <span class="operator">+</span> <span class="variable">g</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<p>得到的结果与我们的期望一致，但是</p>
<figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="number">1</span>;</span><br><span class="line">rule = (f[x_] -&gt; x^<span class="number">2</span>);</span><br><span class="line">f[<span class="number">5</span>] + g[<span class="number">2</span>] /. rule</span><br><span class="line">&gt; <span class="number">1</span> + g[<span class="number">2</span>]</span><br></pre></td></tr></table></figure>
<p>就会出现问题，这是因为规则直接将全局变量带入了，变成了：</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">rule</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">f</span><span class="punctuation">[</span><span class="type">x_</span><span class="punctuation">]</span> <span class="operator">-&gt;</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>但是如果使用延迟规则：</p>
<figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="number">1</span>;</span><br><span class="line">rule = f[x_] :&gt; x^<span class="number">2</span>;</span><br><span class="line">f[<span class="number">5</span>] + g[<span class="number">2</span>] /. rule</span><br><span class="line">&gt; <span class="number">25</span> + g[<span class="number">2</span>]</span><br></pre></td></tr></table></figure>
<p>规则和延迟规则(以及赋值和延迟赋值)的区别在于：规则指向的表达式会被<code>Mathematica</code>立刻取值，以后应用这条规则时将直接引用这个值；而延迟规则指向的表达式会被<code>Mathematica</code>认为是一个程序的入口，之后每次应用这条规则时，<code>Mathematica</code>都会重新计算一边这个表达式。</p>
<p>当规则不止一条时，我们把所有规则组成一个表，然后应用它。</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">(</span><span class="variable">a</span><span class="operator">^</span><span class="variable">b</span><span class="punctuation">)</span><span class="operator">^</span><span class="variable">c</span> <span class="operator">/.</span> <span class="punctuation">&#123;</span><span class="punctuation">(</span><span class="type">x_</span><span class="operator">^</span><span class="type">y_</span><span class="punctuation">)</span><span class="operator">^</span><span class="type">z_</span> <span class="operator">:&gt;</span> <span class="variable">x</span><span class="operator">^</span><span class="punctuation">(</span><span class="variable">y</span> <span class="variable">z</span><span class="punctuation">)</span><span class="operator">,</span> <span class="variable">a</span> <span class="operator">-&gt;</span> <span class="number">2</span><span class="operator">,</span> <span class="variable">b</span> <span class="operator">-&gt;</span> <span class="number">3</span><span class="operator">,</span> <span class="variable">c</span> <span class="operator">-&gt;</span> <span class="number">4</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">a</span><span class="operator">^</span><span class="punctuation">(</span><span class="variable">b</span> <span class="variable">c</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>我们发现只应用了第一个规则，其他规则都没用。这是因为匹配到规则表中的某个规则后，这个规则将会被应用一次，他之后的规则将被忽略。如果向反复匹配、应用，直到找不出可进一步化简的模式，可以用<code>//.</code>。</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">rule</span> <span class="operator">=</span> <span class="punctuation">&#123;</span><span class="built_in">Log</span><span class="punctuation">[</span><span class="type">x_</span> <span class="type">y_</span><span class="punctuation">]</span> <span class="operator">:&gt;</span> <span class="built_in">Log</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span> <span class="operator">+</span> <span class="built_in">Log</span><span class="punctuation">[</span><span class="variable">y</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">Log</span><span class="punctuation">[</span><span class="variable">a</span> <span class="variable">b</span> <span class="variable">c</span> <span class="variable">d</span><span class="punctuation">]</span> <span class="operator">/.</span> <span class="variable">rule</span></span><br><span class="line"><span class="built_in">Log</span><span class="punctuation">[</span><span class="variable">a</span> <span class="variable">b</span> <span class="variable">c</span> <span class="variable">d</span><span class="punctuation">]</span> <span class="operator">/.</span> <span class="variable">rule</span> <span class="operator">/.</span> <span class="variable">rule</span></span><br><span class="line"><span class="built_in">Log</span><span class="punctuation">[</span><span class="variable">a</span> <span class="variable">b</span> <span class="variable">c</span> <span class="variable">d</span><span class="punctuation">]</span> <span class="operator">//.</span> <span class="variable">rule</span></span><br><span class="line"><span class="built_in">FixedPoint</span><span class="punctuation">[</span><span class="type">#</span> <span class="operator">/.</span> <span class="variable">rule</span> <span class="operator">&amp;,</span> <span class="built_in">Log</span><span class="punctuation">[</span><span class="variable">a</span> <span class="variable">b</span> <span class="variable">c</span> <span class="variable">d</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">Log</span><span class="punctuation">[</span><span class="variable">a</span><span class="punctuation">]</span> <span class="operator">+</span> <span class="built_in">Log</span><span class="punctuation">[</span><span class="variable">b</span> <span class="variable">c</span> <span class="variable">d</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">Log</span><span class="punctuation">[</span><span class="variable">a</span><span class="punctuation">]</span> <span class="operator">+</span> <span class="built_in">Log</span><span class="punctuation">[</span><span class="variable">b</span><span class="punctuation">]</span> <span class="operator">+</span> <span class="built_in">Log</span><span class="punctuation">[</span><span class="variable">c</span> <span class="variable">d</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">Log</span><span class="punctuation">[</span><span class="variable">a</span><span class="punctuation">]</span> <span class="operator">+</span> <span class="built_in">Log</span><span class="punctuation">[</span><span class="variable">b</span><span class="punctuation">]</span> <span class="operator">+</span> <span class="built_in">Log</span><span class="punctuation">[</span><span class="variable">c</span><span class="punctuation">]</span> <span class="operator">+</span> <span class="built_in">Log</span><span class="punctuation">[</span><span class="variable">d</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">Log</span><span class="punctuation">[</span><span class="variable">a</span><span class="punctuation">]</span> <span class="operator">+</span> <span class="built_in">Log</span><span class="punctuation">[</span><span class="variable">b</span><span class="punctuation">]</span> <span class="operator">+</span> <span class="built_in">Log</span><span class="punctuation">[</span><span class="variable">c</span><span class="punctuation">]</span> <span class="operator">+</span> <span class="built_in">Log</span><span class="punctuation">[</span><span class="variable">d</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<p><code>FixedPoint</code>函数将一个函数应用到某个对象，直到这个对象不变为止，<code>.//</code>就是这样实现的。</p>
<p>运算符<code>/.</code>和<code>//.</code>的全名分别是ReplaceAll和ReplaceRepeated，它们的一个共同特点是它们会对它们左边表达式的每个子表达式进行匹配和替换。有些时候我们希望控制这种搜索的深度，这时候就需要用Replace这个函数。</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Replace</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">^</span><span class="number">2</span><span class="operator">,</span> <span class="variable">x</span><span class="operator">^</span><span class="number">2</span> <span class="operator">-&gt;</span> <span class="variable">a</span><span class="operator">^</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">Replace</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">^</span><span class="number">2</span><span class="operator">,</span> <span class="variable">x</span> <span class="operator">-&gt;</span> <span class="variable">a</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">Replace</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">^</span><span class="number">2</span><span class="operator">,</span> <span class="variable">x</span> <span class="operator">-&gt;</span> <span class="variable">a</span><span class="operator">,</span> <span class="number">2</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">a</span><span class="operator">^</span><span class="number">2</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">x</span><span class="operator">^</span><span class="number">2</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">a</span><span class="operator">^</span><span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>Replace只返回第一个匹配成功的重写结果，有时候我们希望考察所有可能的重写结果，这时候可以用ReplaceList这个函数。</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Replace</span><span class="punctuation">[</span><span class="variable">a</span> <span class="operator">+</span> <span class="variable">b</span> <span class="operator">+</span> <span class="variable">c</span><span class="operator">,</span> <span class="type">x_</span> <span class="operator">+</span> <span class="type">y_</span> <span class="operator">:&gt;</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">,</span> <span class="variable">y</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">ReplaceList</span><span class="punctuation">[</span><span class="variable">a</span> <span class="operator">+</span> <span class="variable">b</span> <span class="operator">+</span> <span class="variable">c</span><span class="operator">,</span> <span class="type">x_</span> <span class="operator">+</span> <span class="type">y_</span> <span class="operator">:&gt;</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">,</span> <span class="variable">y</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">a</span><span class="operator">,</span> <span class="variable">b</span> <span class="operator">+</span> <span class="variable">c</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="variable">f</span><span class="punctuation">[</span><span class="variable">a</span><span class="operator">,</span> <span class="variable">b</span> <span class="operator">+</span> <span class="variable">c</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">b</span><span class="operator">,</span> <span class="variable">a</span> <span class="operator">+</span> <span class="variable">c</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">c</span><span class="operator">,</span> <span class="variable">a</span> <span class="operator">+</span> <span class="variable">b</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">a</span> <span class="operator">+</span> <span class="variable">b</span><span class="operator">,</span> <span class="variable">c</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">a</span> <span class="operator">+</span> <span class="variable">c</span><span class="operator">,</span> <span class="variable">b</span><span class="punctuation">]</span><span class="operator">,</span> </span><br><span class="line"> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">b</span> <span class="operator">+</span> <span class="variable">c</span><span class="operator">,</span> <span class="variable">a</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>例：打印乘法表</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">times</span><span class="punctuation">[</span><span class="type">x_</span><span class="operator">,</span> <span class="type">y_</span><span class="punctuation">]</span> <span class="operator">:=</span> </span><br><span class="line">  <span class="built_in">ToString</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span> <span class="operator">&lt;&gt;</span> <span class="string">&quot;x&quot;</span> <span class="operator">&lt;&gt;</span> <span class="built_in">ToString</span><span class="punctuation">[</span><span class="variable">y</span><span class="punctuation">]</span> <span class="operator">&lt;&gt;</span> <span class="string">&quot;=&quot;</span> <span class="operator">&lt;&gt;</span> <span class="built_in">ToString</span><span class="punctuation">[</span><span class="variable">x</span> <span class="variable">y</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span><span class="string">&quot;1x1=1&quot;</span><span class="operator">,</span> <span class="string">&quot;1x2=2&quot;</span><span class="operator">,</span> <span class="string">&quot;1x3=3&quot;</span><span class="operator">,</span> <span class="string">&quot;1x4=4&quot;</span><span class="operator">,</span> <span class="string">&quot;1x5=5&quot;</span><span class="operator">,</span> <span class="string">&quot;1x6=6&quot;</span><span class="operator">,</span> <span class="string">&quot;1x7=7&quot;</span><span class="operator">,</span> \</span><br><span class="line"><span class="string">&quot;1x8=8&quot;</span><span class="operator">,</span> <span class="string">&quot;1x9=9&quot;</span><span class="operator">,</span> <span class="string">&quot;2x2=4&quot;</span><span class="operator">,</span> <span class="string">&quot;2x3=6&quot;</span><span class="operator">,</span> <span class="string">&quot;2x4=8&quot;</span><span class="operator">,</span> <span class="string">&quot;2x5=10&quot;</span><span class="operator">,</span> <span class="string">&quot;2x6=12&quot;</span><span class="operator">,</span> \</span><br><span class="line"><span class="string">&quot;2x7=14&quot;</span><span class="operator">,</span> <span class="string">&quot;2x8=16&quot;</span><span class="operator">,</span> <span class="string">&quot;2x9=18&quot;</span><span class="operator">,</span> <span class="string">&quot;3x3=9&quot;</span><span class="operator">,</span> <span class="string">&quot;3x4=12&quot;</span><span class="operator">,</span> <span class="string">&quot;3x5=15&quot;</span><span class="operator">,</span> <span class="string">&quot;3x6=18&quot;</span><span class="operator">,</span> \</span><br><span class="line"><span class="string">&quot;3x7=21&quot;</span><span class="operator">,</span> <span class="string">&quot;3x8=24&quot;</span><span class="operator">,</span> <span class="string">&quot;3x9=27&quot;</span><span class="operator">,</span> <span class="string">&quot;4x4=16&quot;</span><span class="operator">,</span> <span class="string">&quot;4x5=20&quot;</span><span class="operator">,</span> <span class="string">&quot;4x6=24&quot;</span><span class="operator">,</span> <span class="string">&quot;4x7=28&quot;</span><span class="operator">,</span> \</span><br><span class="line"><span class="string">&quot;4x8=32&quot;</span><span class="operator">,</span> <span class="string">&quot;4x9=36&quot;</span><span class="operator">,</span> <span class="string">&quot;5x5=25&quot;</span><span class="operator">,</span> <span class="string">&quot;5x6=30&quot;</span><span class="operator">,</span> <span class="string">&quot;5x7=35&quot;</span><span class="operator">,</span> <span class="string">&quot;5x8=40&quot;</span><span class="operator">,</span> <span class="string">&quot;5x9=45&quot;</span><span class="operator">,</span> \</span><br><span class="line"><span class="string">&quot;6x6=36&quot;</span><span class="operator">,</span> <span class="string">&quot;6x7=42&quot;</span><span class="operator">,</span> <span class="string">&quot;6x8=48&quot;</span><span class="operator">,</span> <span class="string">&quot;6x9=54&quot;</span><span class="operator">,</span> <span class="string">&quot;7x7=49&quot;</span><span class="operator">,</span> <span class="string">&quot;7x8=56&quot;</span><span class="operator">,</span> <span class="string">&quot;7x9=63&quot;</span><span class="operator">,</span> \</span><br><span class="line"><span class="string">&quot;8x8=64&quot;</span><span class="operator">,</span> <span class="string">&quot;8x9=72&quot;</span><span class="operator">,</span> <span class="string">&quot;9x9=81&quot;</span><span class="punctuation">&#125;</span><span class="variable">timesTable</span><span class="punctuation">[</span><span class="type">n_</span><span class="punctuation">]</span> <span class="operator">:=</span> </span><br><span class="line">  <span class="variable">times</span> <span class="operator">@@@</span> </span><br><span class="line">   <span class="built_in">Sort</span><span class="punctuation">[</span><span class="built_in">ReplaceList</span><span class="punctuation">[</span></span><br><span class="line">     <span class="built_in">Range</span><span class="punctuation">[</span><span class="variable">n</span><span class="punctuation">]</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="punctuation">&#123;</span><span class="type">___</span><span class="operator">,</span> <span class="type">x_</span><span class="operator">,</span> <span class="type">___</span><span class="punctuation">&#125;</span> <span class="operator">:&gt;</span> <span class="punctuation">&#123;</span><span class="variable">x</span><span class="operator">,</span> <span class="variable">x</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="type">___</span><span class="operator">,</span> <span class="type">x_</span><span class="operator">,</span> <span class="type">___</span><span class="operator">,</span> </span><br><span class="line">        <span class="type">y_</span><span class="operator">,</span> <span class="type">___</span><span class="punctuation">&#125;</span> <span class="operator">:&gt;</span> <span class="punctuation">&#123;</span><span class="variable">x</span><span class="operator">,</span> <span class="variable">y</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="variable">timesTable</span><span class="punctuation">[</span><span class="number">9</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span><span class="string">&quot;1x1=1&quot;</span><span class="operator">,</span> <span class="string">&quot;1x2=2&quot;</span><span class="operator">,</span> <span class="string">&quot;1x3=3&quot;</span><span class="operator">,</span> <span class="string">&quot;1x4=4&quot;</span><span class="operator">,</span> <span class="string">&quot;1x5=5&quot;</span><span class="operator">,</span> <span class="string">&quot;1x6=6&quot;</span><span class="operator">,</span> <span class="string">&quot;1x7=7&quot;</span><span class="operator">,</span> \</span><br><span class="line"><span class="string">&quot;1x8=8&quot;</span><span class="operator">,</span> <span class="string">&quot;1x9=9&quot;</span><span class="operator">,</span> <span class="string">&quot;2x2=4&quot;</span><span class="operator">,</span> <span class="string">&quot;2x3=6&quot;</span><span class="operator">,</span> <span class="string">&quot;2x4=8&quot;</span><span class="operator">,</span> <span class="string">&quot;2x5=10&quot;</span><span class="operator">,</span> <span class="string">&quot;2x6=12&quot;</span><span class="operator">,</span> \</span><br><span class="line"><span class="string">&quot;2x7=14&quot;</span><span class="operator">,</span> <span class="string">&quot;2x8=16&quot;</span><span class="operator">,</span> <span class="string">&quot;2x9=18&quot;</span><span class="operator">,</span> <span class="string">&quot;3x3=9&quot;</span><span class="operator">,</span> <span class="string">&quot;3x4=12&quot;</span><span class="operator">,</span> <span class="string">&quot;3x5=15&quot;</span><span class="operator">,</span> <span class="string">&quot;3x6=18&quot;</span><span class="operator">,</span> \</span><br><span class="line"><span class="string">&quot;3x7=21&quot;</span><span class="operator">,</span> <span class="string">&quot;3x8=24&quot;</span><span class="operator">,</span> <span class="string">&quot;3x9=27&quot;</span><span class="operator">,</span> <span class="string">&quot;4x4=16&quot;</span><span class="operator">,</span> <span class="string">&quot;4x5=20&quot;</span><span class="operator">,</span> <span class="string">&quot;4x6=24&quot;</span><span class="operator">,</span> <span class="string">&quot;4x7=28&quot;</span><span class="operator">,</span> \</span><br><span class="line"><span class="string">&quot;4x8=32&quot;</span><span class="operator">,</span> <span class="string">&quot;4x9=36&quot;</span><span class="operator">,</span> <span class="string">&quot;5x5=25&quot;</span><span class="operator">,</span> <span class="string">&quot;5x6=30&quot;</span><span class="operator">,</span> <span class="string">&quot;5x7=35&quot;</span><span class="operator">,</span> <span class="string">&quot;5x8=40&quot;</span><span class="operator">,</span> <span class="string">&quot;5x9=45&quot;</span><span class="operator">,</span> \</span><br><span class="line"><span class="string">&quot;6x6=36&quot;</span><span class="operator">,</span> <span class="string">&quot;6x7=42&quot;</span><span class="operator">,</span> <span class="string">&quot;6x8=48&quot;</span><span class="operator">,</span> <span class="string">&quot;6x9=54&quot;</span><span class="operator">,</span> <span class="string">&quot;7x7=49&quot;</span><span class="operator">,</span> <span class="string">&quot;7x8=56&quot;</span><span class="operator">,</span> <span class="string">&quot;7x9=63&quot;</span><span class="operator">,</span> \</span><br><span class="line"><span class="string">&quot;8x8=64&quot;</span><span class="operator">,</span> <span class="string">&quot;8x9=72&quot;</span><span class="operator">,</span> <span class="string">&quot;9x9=81&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>之前我们提到过<code>@@</code>可以换头，而<code>@@@</code>可以换内部的头：</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">head</span> <span class="operator">@@@</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">g</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">h</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">,</span> <span class="variable">y</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">k</span><span class="punctuation">[</span><span class="variable">a</span><span class="operator">,</span> <span class="variable">b</span><span class="operator">,</span> <span class="variable">c</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">head</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">head</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">,</span> <span class="variable">y</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">head</span><span class="punctuation">[</span><span class="variable">a</span><span class="operator">,</span> <span class="variable">b</span><span class="operator">,</span> <span class="variable">c</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<p>规则(Rule、Delayed)和替换(Replace、ReplaceAll、ReplaceRepeated、ReplaceList)是比较安全的重写机制，下面我们看不安全的重写、即赋值。</p>
<p>赋值与规则的一大不同是：赋值操作所定义的重写方法则总是从属于某个符号的，而规则是独立存在的。</p>
<p>为什么会如此？因为如果不将全局规则(赋值)分派给某个符号，而是作为独立规则存在，那么在做任何计算的时候，都要检查以下待计算的表达式中是否有能够匹配全局规则的子表达式存在，这是极大的浪费。如果全局规则从属于某个符号，那么只有在遇到这个符号的时候我们才需要去尝试匹配，这就比较有效率。</p>
<p>运算符<code>=.</code>每次清掉一条赋值，如果想要清空所有赋值，可以用<code>Clear</code>函数：</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">f</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="number">1</span><span class="operator">;</span></span><br><span class="line"><span class="variable">f</span><span class="punctuation">[</span><span class="type">n_</span><span class="punctuation">]</span> <span class="operator">:=</span> <span class="variable">n</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">n</span> <span class="operator">-</span> <span class="number">1</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="variable">f</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">=.</span> <span class="comment">(*只清除f[1]*)</span></span><br><span class="line"><span class="built_in">Clear</span><span class="punctuation">[</span><span class="variable">f</span><span class="punctuation">]</span> <span class="comment">(*清空所有f*)</span></span><br><span class="line"><span class="built_in">Clear</span><span class="punctuation">[</span><span class="string">&quot;Global`*&quot;</span><span class="punctuation">]</span><span class="comment">(*清空所有变量*)</span></span><br></pre></td></tr></table></figure>
<p>Clear的作用是清掉规则，之后的符号还存在于系统中，还占着内存。如果想完全移除这个变量，将它占用的内存释放掉，则应该用Remove。</p>
<p>赋值行为也可以以其他的形式出现：</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">i</span><span class="operator">=</span><span class="number">1</span><span class="operator">;</span></span><br><span class="line"><span class="variable">x</span><span class="operator">=</span><span class="number">1</span><span class="operator">;</span></span><br><span class="line"><span class="variable">i</span><span class="operator">++</span></span><br><span class="line"><span class="variable">i</span><span class="operator">--</span></span><br><span class="line"><span class="operator">++</span><span class="variable">i</span></span><br><span class="line"><span class="operator">--</span><span class="variable">i</span></span><br><span class="line"><span class="variable">i</span> <span class="operator">+=</span> <span class="variable">di</span></span><br><span class="line"><span class="variable">i</span> <span class="operator">-=</span> <span class="variable">di</span></span><br><span class="line"><span class="variable">x</span> <span class="operator">*=</span> <span class="variable">c</span></span><br><span class="line"><span class="variable">x</span> <span class="operator">/=</span> <span class="variable">c</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="number">1</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="number">2</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="number">2</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="number">1</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="number">1</span><span class="operator">+</span> <span class="variable">di</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="number">1</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">c</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>赋值还可以同时进行</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">x</span> <span class="operator">=</span> <span class="variable">y</span> <span class="operator">=</span> <span class="variable">value</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="variable">x</span><span class="operator">,</span> <span class="variable">y</span><span class="punctuation">&#125;</span> <span class="operator">=</span> <span class="punctuation">&#123;</span><span class="variable">value1</span><span class="operator">,</span> <span class="variable">value2</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="variable">x</span><span class="operator">,</span> <span class="variable">y</span><span class="punctuation">&#125;</span> <span class="operator">=</span> <span class="punctuation">&#123;</span><span class="variable">y</span><span class="operator">,</span> <span class="variable">x</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>有一些函数可以改变其参数的值：</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">list</span> <span class="operator">=</span> <span class="punctuation">&#123;</span><span class="variable">a</span><span class="operator">,</span> <span class="variable">b</span><span class="operator">,</span> <span class="variable">c</span><span class="punctuation">&#125;</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">AppendTo</span><span class="punctuation">[</span><span class="variable">list</span> <span class="operator">,</span><span class="variable">d</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">PrependTo</span><span class="punctuation">[</span><span class="variable">list</span><span class="operator">,</span> <span class="variable">z</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<p>再次强调一下，AppendTo和PrependTo这两个函数是比较慢的。对于比较长的表，尽量不要反复用它们。</p>
<p>当习惯于C语言编程的人编写Mathematica程序的时候，总是喜欢用表来存储数组。</p>
<p>事实上在Mathematica中，更好的做法是把数组视为从自然数到其他集合的函数：</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">a</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="number">1</span><span class="operator">;</span></span><br><span class="line"><span class="variable">a</span><span class="punctuation">[</span><span class="type">n_</span><span class="punctuation">]</span> <span class="operator">:=</span> <span class="variable">n</span><span class="operator">/</span><span class="number">2</span> <span class="operator">/;</span> <span class="built_in">EvenQ</span><span class="punctuation">[</span><span class="variable">n</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">Array</span><span class="punctuation">[</span><span class="variable">a</span><span class="operator">,</span> <span class="number">10</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="number">1</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="variable">a</span><span class="punctuation">[</span><span class="number">3</span><span class="punctuation">]</span><span class="operator">,</span> <span class="number">2</span><span class="operator">,</span> <span class="variable">a</span><span class="punctuation">[</span><span class="number">5</span><span class="punctuation">]</span><span class="operator">,</span> <span class="number">3</span><span class="operator">,</span> <span class="variable">a</span><span class="punctuation">[</span><span class="number">7</span><span class="punctuation">]</span><span class="operator">,</span> <span class="number">4</span><span class="operator">,</span> <span class="variable">a</span><span class="punctuation">[</span><span class="number">9</span><span class="punctuation">]</span><span class="operator">,</span> <span class="number">5</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>这样的好处是，函数对象不需要初始化，也不需要指定尺寸。</p>
<p>另外，函数的自变量可以是任何东西，所以可以实现一些更有趣的结构。</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">张三<span class="punctuation">[</span>身高<span class="punctuation">]</span> <span class="operator">=</span> <span class="number">1.75</span> <span class="variable">m</span><span class="operator">;</span></span><br><span class="line">张三<span class="punctuation">[</span>体重<span class="punctuation">]</span> <span class="operator">=</span> <span class="number">70</span> <span class="variable">kg</span><span class="operator">;</span></span><br><span class="line">谁<span class="type">_</span><span class="punctuation">[</span><span class="variable">BMI</span><span class="punctuation">]</span> <span class="operator">^:=</span> 谁<span class="punctuation">[</span>体重<span class="punctuation">]</span> <span class="operator">/</span> 谁<span class="punctuation">[</span>身高<span class="punctuation">]</span><span class="operator">^</span><span class="number">2</span><span class="operator">;</span></span><br><span class="line">张三<span class="punctuation">[</span><span class="variable">BMI</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">(</span><span class="number">22.8571</span> <span class="variable">kg</span><span class="punctuation">)</span><span class="operator">/</span><span class="variable">m</span><span class="operator">^</span><span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>这种写法实际上体现了一种面向对象编程的想法，下面是另一种更花哨的写法：</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">张三 <span class="operator">/:</span> 张三<span class="operator">.</span>身高 <span class="operator">=</span> <span class="number">1.75</span> <span class="variable">m</span><span class="operator">;</span></span><br><span class="line">张三 <span class="operator">/:</span> 张三<span class="operator">.</span>体重 <span class="operator">=</span> <span class="number">70</span> <span class="variable">kg</span><span class="operator">;</span></span><br><span class="line"><span class="variable">BMI</span> <span class="operator">/:</span> <span class="punctuation">(</span>谁<span class="type">_</span><span class="punctuation">)</span><span class="operator">.</span><span class="variable">BMI</span> <span class="operator">:=</span> <span class="punctuation">(</span>谁<span class="operator">.</span>体重<span class="punctuation">)</span><span class="operator">/</span><span class="punctuation">(</span>谁<span class="operator">.</span>身高<span class="punctuation">)</span><span class="operator">^</span><span class="number">2</span></span><br><span class="line">张三<span class="operator">.</span><span class="variable">BMI</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">(</span><span class="number">22.8571</span> <span class="variable">kg</span><span class="punctuation">)</span><span class="operator">/</span><span class="variable">m</span><span class="operator">^</span><span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>新出现的两个运算符<code>^:=</code>和<code>/:</code>我们稍后再解释。</p>
<p>赋值和规则的另一个重大不同是：多次赋值产出的规则表是按照从特殊到一般的顺序来应用的，而且与它们出现的顺序无关；规则表则不同，应用顺序等于它们在表中的排列顺序。</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">f</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="number">1</span><span class="operator">;</span></span><br><span class="line"><span class="variable">f</span><span class="punctuation">[</span><span class="type">n_</span><span class="punctuation">]</span> <span class="operator">:=</span> <span class="variable">n</span> <span class="operator">+</span> <span class="number">1</span><span class="operator">;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="variable">f</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="number">1</span><span class="operator">,</span> <span class="number">3</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">g</span><span class="punctuation">[</span><span class="type">n_</span><span class="punctuation">]</span> <span class="operator">:=</span> <span class="variable">n</span> <span class="operator">+</span> <span class="number">1</span><span class="operator">;</span></span><br><span class="line"><span class="variable">g</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="number">1</span><span class="operator">;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="variable">g</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">g</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="number">1</span><span class="operator">,</span> <span class="number">3</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>在这里<code>f[1]=1</code>和<code>g[n]=1</code>为特殊规则，故不管顺序如何，结果都是<code>&#123;1,3&#125;</code>。</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="variable">h</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">h</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">&#125;</span> <span class="operator">/.</span> <span class="punctuation">&#123;</span><span class="variable">h</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">-&gt;</span> <span class="number">1</span><span class="operator">,</span> <span class="variable">h</span><span class="punctuation">[</span><span class="type">n_</span><span class="punctuation">]</span> <span class="operator">:&gt;</span> <span class="variable">n</span> <span class="operator">+</span> <span class="number">1</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="variable">h</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">h</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">&#125;</span> <span class="operator">/.</span> <span class="punctuation">&#123;</span><span class="variable">h</span><span class="punctuation">[</span><span class="type">n_</span><span class="punctuation">]</span> <span class="operator">:&gt;</span> <span class="variable">n</span> <span class="operator">+</span> <span class="number">1</span><span class="operator">,</span> <span class="variable">h</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">-&gt;</span> <span class="number">1</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="number">1</span><span class="operator">,</span> <span class="number">3</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="number">2</span><span class="operator">,</span> <span class="number">3</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>而规则则与顺序有关。</p>
<p>如果要使用很长的规则表<code>&#123;p1-&gt;r1,p2-&gt;r2,......&#125;</code>，最好用<code>Mathematica</code>内部函数<code>Dispatch</code>压缩一下，这样可以提高替换的效率。</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">rules</span> <span class="operator">=</span> <span class="built_in">Table</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">[</span><span class="variable">i</span><span class="punctuation">]</span> <span class="operator">-&gt;</span> <span class="built_in">RandomInteger</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="number">1</span><span class="operator">,</span> <span class="variable">i</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="variable">i</span><span class="operator">,</span> <span class="number">10000</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="variable">dispatch</span> <span class="operator">=</span> <span class="built_in">Dispatch</span><span class="punctuation">[</span><span class="variable">rules</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">Timing</span><span class="punctuation">[</span><span class="built_in">Table</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">[</span><span class="variable">i</span><span class="punctuation">]</span> <span class="operator">/.</span> <span class="variable">rules</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="variable">i</span><span class="operator">,</span> <span class="number">10000</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="operator">;</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">Timing</span><span class="punctuation">[</span><span class="built_in">Table</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">[</span><span class="variable">i</span><span class="punctuation">]</span> <span class="operator">/.</span> <span class="variable">dispatch</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="variable">i</span><span class="operator">,</span> <span class="number">10000</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="operator">;</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="number">2.125</span><span class="operator">,</span> <span class="built_in">Null</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="number">0.015625</span><span class="operator">,</span> <span class="built_in">Null</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p><code>Mathematica</code>中同时赋值、延迟赋值和全局规则等原理可以帮助我们实现一种非常优雅的机制。</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">f</span><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="number">1</span><span class="operator">;</span></span><br><span class="line"><span class="variable">f</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="number">1</span><span class="operator">;</span></span><br><span class="line"><span class="variable">f</span><span class="punctuation">[</span><span class="type">n_</span><span class="punctuation">]</span> <span class="operator">:=</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">n</span> <span class="operator">-</span> <span class="number">1</span><span class="punctuation">]</span> <span class="operator">+</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">n</span> <span class="operator">-</span> <span class="number">2</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">Timing</span><span class="punctuation">[</span><span class="variable">f</span><span class="punctuation">[</span><span class="number">20</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="number">0.015625</span><span class="operator">,</span> <span class="number">10946</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">g</span><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="number">1</span><span class="operator">;</span></span><br><span class="line"><span class="variable">g</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="number">1</span><span class="operator">;</span></span><br><span class="line"><span class="variable">g</span><span class="punctuation">[</span><span class="type">n_</span><span class="punctuation">]</span> <span class="operator">:=</span> <span class="variable">g</span><span class="punctuation">[</span><span class="variable">n</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="variable">g</span><span class="punctuation">[</span><span class="variable">n</span> <span class="operator">-</span> <span class="number">1</span><span class="punctuation">]</span> <span class="operator">+</span> <span class="variable">g</span><span class="punctuation">[</span><span class="variable">n</span> <span class="operator">-</span> <span class="number">2</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">Timing</span><span class="punctuation">[</span><span class="variable">g</span><span class="punctuation">[</span><span class="number">20</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="number">0.</span><span class="operator">,</span> <span class="number">10946</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>可以看到比之前快了很多。在后一种实现中，因为多了一个同时赋值，所以之前计算过的值都被自动存储下来，这对于递归函数来说非常重要，因为可以减少大量的重复计算。</p>
<p>我们之前说过，赋值这个规则总是从属于某个符号的。一个重要的问题是，到底从属于哪个符号？</p>
<p>对于下面的语句</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">F</span><span class="punctuation">[</span><span class="variable">X1</span><span class="operator">,</span><span class="variable">X2</span><span class="operator">,...,</span><span class="variable">Xn</span><span class="punctuation">]</span><span class="operator">=</span><span class="variable">value</span></span><br></pre></td></tr></table></figure>
<p>Mathematica默认这样一条规则是从属于符号F。</p>
<p>但这未必是我们想要的，例如前面张三的BMI这个例子中，左边表达式的头”谁_”是一个模式，而不是固定的符号，这时候就无法分配这条规则。另一种情况是：</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">log</span><span class="punctuation">[</span><span class="type">x_</span><span class="punctuation">]</span> <span class="operator">+</span> <span class="variable">log</span><span class="punctuation">[</span><span class="type">y_</span><span class="punctuation">]</span> <span class="operator">:=</span> <span class="variable">log</span><span class="punctuation">[</span><span class="variable">x</span> <span class="variable">y</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<p>因为左边表达式的头为<code>Plus</code>，我们无法改变其规则。尽管我们可以通过解除保护的方法强行对函数Plus增加一条规则，但这不是正确的做法。因为这样做的后果是，系统每次进行加法运算都不得不检查待计算的表达式是否符合我们增加的这条规则，这是极大的资源浪费。</p>
<p>对于这两种情况，我们都需要一种机制，来指定规则所从属的对象。例如在第一个例子中，我们可以将这条规则指定给BMI这个符号，在第二个例子中，我们可以将规则给自定义函数log。</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">log</span><span class="punctuation">[</span><span class="type">x_</span><span class="punctuation">]</span> <span class="operator">+</span> <span class="variable">log</span><span class="punctuation">[</span><span class="type">y_</span><span class="punctuation">]</span> <span class="operator">^:=</span> <span class="variable">log</span><span class="punctuation">[</span><span class="variable">x</span> <span class="variable">y</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="operator">?</span><span class="variable">log</span></span><br><span class="line"><span class="operator">&gt;</span>  <span class="variable">UpValue</span> <span class="variable">Definitions</span>	<span class="variable">log</span><span class="punctuation">[</span><span class="type">x_</span><span class="punctuation">]</span><span class="operator">+</span><span class="variable">log</span><span class="punctuation">[</span><span class="type">y_</span><span class="punctuation">]</span><span class="operator">^:=</span><span class="variable">log</span><span class="punctuation">[</span><span class="variable">x</span> <span class="variable">y</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<p>可以看到这条规则附属于log。</p>
<p>一般来说，运算符<code>^:=</code>会将这条规则指定给下层的所有不受保护的函数，此时赋值号右边的值叫做这些函数的<code>upvalue</code>。</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">f</span><span class="punctuation">[</span><span class="variable">g</span><span class="punctuation">[</span><span class="type">x_</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">h</span><span class="punctuation">[</span><span class="type">y_</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">^:=</span> <span class="variable">x</span><span class="operator">^</span><span class="number">2</span> <span class="operator">+</span> <span class="built_in">Sin</span><span class="punctuation">[</span><span class="variable">y</span><span class="punctuation">]</span><span class="operator">;</span></span><br></pre></td></tr></table></figure>
<p>此时规则挂在<code>f</code>下的函数<code>g</code>和<code>h</code>上。</p>
<p>如果我们想要更明确地指派规则，可以用：</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">g</span> <span class="operator">/:</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">g</span><span class="punctuation">[</span><span class="type">x_</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">h</span><span class="punctuation">[</span><span class="type">y_</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">:=</span> <span class="variable">x</span><span class="operator">^</span><span class="number">2</span> <span class="operator">+</span> <span class="built_in">Sin</span><span class="punctuation">[</span><span class="variable">y</span><span class="punctuation">]</span><span class="operator">;</span></span><br></pre></td></tr></table></figure>
<p>这样规则就只定义在<code>g</code>上。</p>
<p>但是需要注意的是，这种规则指派只能改动一层，如果再深一层就不被允许了。</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">g</span><span class="operator">/:</span><span class="variable">f</span><span class="punctuation">[</span><span class="variable">h</span><span class="punctuation">[</span><span class="variable">g</span><span class="punctuation">[</span><span class="type">x_</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="operator">:=</span> <span class="variable">x</span><span class="operator">+</span><span class="number">1</span><span class="operator">;</span><span class="comment">(*出错*)</span></span><br></pre></td></tr></table></figure>
<h2 id="第五周"><a href="#第五周" class="headerlink" title="第五周"></a>第五周</h2><h3 id="函数与泛函编程"><a href="#函数与泛函编程" class="headerlink" title="函数与泛函编程"></a>函数与泛函编程</h3><p>前缀、中缀和后缀：</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">f</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span></span><br><span class="line"><span class="variable">f</span><span class="operator">@</span><span class="variable">x</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="variable">f</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">,</span> <span class="variable">y</span><span class="punctuation">]</span></span><br><span class="line"><span class="variable">x</span><span class="operator">~</span><span class="variable">f</span><span class="operator">~</span><span class="variable">y</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">,</span><span class="variable">y</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">,</span><span class="variable">y</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="variable">f</span><span class="punctuation">[</span><span class="variable">g</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="variable">f</span><span class="operator">@</span><span class="variable">g</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span></span><br><span class="line"><span class="variable">f</span><span class="operator">@</span><span class="variable">g</span><span class="operator">@</span><span class="variable">x</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">g</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">g</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">g</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="variable">x</span> <span class="operator">//</span> <span class="variable">g</span> <span class="operator">//</span> <span class="variable">f</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">g</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<h4 id="函数的属性"><a href="#函数的属性" class="headerlink" title="函数的属性"></a>函数的属性</h4><p><code>Orderless</code>：交换性</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">SetAttributes</span><span class="punctuation">[</span><span class="variable">f</span><span class="operator">,</span> <span class="built_in">Orderless</span><span class="punctuation">]</span><span class="operator">;</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">,</span> <span class="variable">y</span><span class="operator">,</span> <span class="variable">z</span><span class="punctuation">]</span> <span class="operator">==</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">y</span><span class="operator">,</span> <span class="variable">z</span><span class="operator">,</span> <span class="variable">x</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">True</span></span><br></pre></td></tr></table></figure>
<p><code>Flat</code>：结合性</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">SetAttributes</span><span class="punctuation">[</span><span class="variable">f</span><span class="operator">,</span> <span class="built_in">Flat</span><span class="punctuation">]</span><span class="operator">;</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">y</span><span class="operator">,</span> <span class="variable">z</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">f</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">,</span> <span class="variable">y</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">z</span><span class="punctuation">]</span> <span class="operator">==</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">,</span> <span class="variable">y</span><span class="operator">,</span> <span class="variable">z</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">True</span></span><br></pre></td></tr></table></figure>
<p><code>OneIdentity</code></p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">SetAttributes</span><span class="punctuation">[</span><span class="variable">f</span><span class="operator">,</span> <span class="built_in">OneIdentity</span><span class="punctuation">]</span><span class="operator">;</span> <span class="built_in">MatchQ</span><span class="punctuation">[</span><span class="variable">a</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="type">x_</span><span class="operator">:</span> <span class="number">0</span><span class="operator">,</span> <span class="type">y_</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">True</span></span><br></pre></td></tr></table></figure>
<p><code>Listable</code></p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">SetAttributes</span><span class="punctuation">[</span><span class="variable">f</span><span class="operator">,</span> <span class="built_in">Listable</span><span class="punctuation">]</span><span class="operator">;</span> <span class="variable">f</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="number">1</span><span class="operator">,</span> <span class="number">2</span><span class="operator">,</span> <span class="number">3</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="variable">f</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="number">3</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h4><p>自定义筛选函数</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">S</span> <span class="operator">=</span> <span class="built_in">Normal</span><span class="operator">@</span><span class="built_in">Series</span><span class="punctuation">[</span><span class="built_in">Cos</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span><span class="operator">/</span><span class="punctuation">(</span><span class="variable">x</span><span class="operator">^</span><span class="number">4</span> <span class="built_in">Tan</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="variable">x</span><span class="operator">,</span> <span class="number">0</span><span class="operator">,</span> <span class="number">5</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="number">1</span><span class="operator">/</span><span class="variable">x</span><span class="operator">^</span><span class="number">5</span> <span class="operator">-</span> <span class="number">5</span><span class="operator">/</span><span class="punctuation">(</span><span class="number">6</span> <span class="variable">x</span><span class="operator">^</span><span class="number">3</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="number">67</span><span class="operator">/</span><span class="punctuation">(</span><span class="number">360</span> <span class="variable">x</span><span class="punctuation">)</span> <span class="operator">-</span> <span class="punctuation">(</span><span class="number">19</span> <span class="variable">x</span><span class="punctuation">)</span><span class="operator">/</span><span class="number">3024</span> <span class="operator">+</span> <span class="punctuation">(</span><span class="number">247</span> <span class="variable">x</span><span class="operator">^</span><span class="number">3</span><span class="punctuation">)</span><span class="operator">/</span><span class="number">604800</span> <span class="operator">+</span> <span class="punctuation">(</span></span><br><span class="line"> <span class="number">89</span> <span class="variable">x</span><span class="operator">^</span><span class="number">5</span><span class="punctuation">)</span><span class="operator">/</span><span class="number">4790016</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">Plus</span> <span class="operator">@@</span> <span class="built_in">Cases</span><span class="punctuation">[</span><span class="variable">S</span><span class="operator">,</span> <span class="type">a_</span><span class="operator">.</span> <span class="variable">x</span><span class="operator">^</span><span class="type">d_</span> <span class="operator">/;</span> <span class="variable">d</span> <span class="operator">&lt;</span> <span class="number">0</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">Select</span><span class="punctuation">[</span><span class="variable">S</span><span class="operator">,</span> <span class="punctuation">(</span><span class="type">#</span> <span class="operator">/.</span> <span class="punctuation">&#123;</span><span class="type">a_</span><span class="operator">.</span> <span class="variable">x</span><span class="operator">^</span><span class="type">d_</span> <span class="operator">:&gt;</span> <span class="variable">d</span><span class="punctuation">&#125;</span><span class="punctuation">)</span> <span class="operator">&lt;</span> <span class="number">0</span> <span class="operator">&amp;</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">Select</span><span class="punctuation">[</span><span class="variable">S</span><span class="operator">,</span> <span class="built_in">MatchQ</span><span class="punctuation">[</span><span class="type">#</span><span class="operator">,</span> <span class="type">a_</span><span class="operator">.</span> <span class="variable">x</span><span class="operator">^</span><span class="type">d_</span> <span class="operator">/;</span> <span class="variable">d</span> <span class="operator">&lt;</span> <span class="number">0</span><span class="punctuation">]</span> <span class="operator">&amp;</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<h4 id="带下标的函数"><a href="#带下标的函数" class="headerlink" title="带下标的函数"></a>带下标的函数</h4><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">p</span> <span class="operator">=</span> <span class="built_in">Plus</span> <span class="operator">@@</span> <span class="punctuation">(</span><span class="punctuation">(</span><span class="variable">g</span> <span class="operator">@@</span> <span class="type">#</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="variable">u</span><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="built_in">Times</span> <span class="operator">@@</span> <span class="variable">u</span> <span class="operator">/@</span> <span class="type">#</span> <span class="operator">&amp;</span> <span class="operator">/@</span> <span class="variable">Partitions</span><span class="punctuation">[</span><span class="number">5</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="variable">u</span><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> <span class="variable">u</span><span class="punctuation">[</span><span class="number">5</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">u</span><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> <span class="variable">u</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="variable">u</span><span class="punctuation">[</span><span class="number">4</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">u</span><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> <span class="variable">u</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span> <span class="variable">u</span><span class="punctuation">[</span><span class="number">3</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">u</span><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> <span class="variable">u</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="operator">^</span><span class="number">2</span> <span class="variable">u</span><span class="punctuation">[</span><span class="number">3</span><span class="punctuation">]</span><span class="operator">,</span> </span><br><span class="line"> <span class="variable">u</span><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> <span class="variable">u</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="variable">u</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="operator">^</span><span class="number">2</span><span class="operator">,</span> <span class="variable">u</span><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> <span class="variable">u</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="operator">^</span><span class="number">3</span> <span class="variable">u</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">u</span><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> <span class="variable">u</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="operator">^</span><span class="number">5</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="函数的函数"><a href="#函数的函数" class="headerlink" title="函数的函数"></a>函数的函数</h4><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">f</span> <span class="operator">=</span> <span class="built_in">Function</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">,</span> <span class="built_in">Function</span><span class="punctuation">[</span><span class="variable">y</span><span class="operator">,</span> <span class="variable">x</span> <span class="operator">+</span> <span class="variable">y</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="variable">f</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line"><span class="variable">f</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">Function</span><span class="punctuation">[</span><span class="variable">y$</span><span class="operator">,</span> <span class="number">2</span> <span class="operator">+</span> <span class="variable">y$</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="number">4</span></span><br></pre></td></tr></table></figure>
<p>这里<code>y$</code>表示一个临时变量。</p>
<h4 id="泛函操作"><a href="#泛函操作" class="headerlink" title="泛函操作"></a>泛函操作</h4><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Map</span><span class="punctuation">[</span><span class="variable">f</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="variable">a</span><span class="operator">,</span> <span class="variable">b</span><span class="operator">,</span> <span class="variable">c</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="variable">f</span> <span class="operator">/@</span> <span class="punctuation">&#123;</span><span class="variable">a</span><span class="operator">,</span> <span class="variable">b</span><span class="operator">,</span> <span class="variable">c</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="variable">f</span><span class="punctuation">[</span><span class="variable">a</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">b</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">c</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="variable">f</span><span class="punctuation">[</span><span class="variable">a</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">b</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">c</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>关于MapIndexed，不止可以得到映射后的值，还会得到索引。</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">MapIndexed</span><span class="punctuation">[</span><span class="variable">f</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="variable">a</span><span class="operator">,</span> <span class="variable">b</span><span class="operator">,</span> <span class="variable">c</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="punctuation">&#123;</span><span class="variable">f</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">,</span> <span class="variable">a</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="variable">f</span><span class="punctuation">[</span><span class="number">2</span><span class="operator">,</span> <span class="variable">b</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="variable">f</span><span class="punctuation">[</span><span class="number">3</span><span class="operator">,</span> <span class="variable">c</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment">(*还可以指定深度*)</span></span><br><span class="line"><span class="built_in">MapIndexed</span><span class="punctuation">[</span><span class="variable">f</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="punctuation">&#123;</span><span class="variable">a</span><span class="operator">,</span> <span class="variable">b</span><span class="operator">,</span> <span class="variable">c</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="variable">e</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="number">2</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="punctuation">&#123;</span><span class="punctuation">&#123;</span><span class="variable">f</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">,</span> <span class="variable">a</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">,</span> <span class="variable">a</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="variable">f</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">,</span> <span class="variable">b</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="number">2</span><span class="operator">,</span> <span class="variable">b</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="variable">f</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">,</span> <span class="variable">c</span><span class="punctuation">]</span><span class="operator">,</span> </span><br><span class="line">   <span class="variable">f</span><span class="punctuation">[</span><span class="number">3</span><span class="operator">,</span> <span class="variable">c</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="punctuation">&#123;</span><span class="variable">f</span><span class="punctuation">[</span><span class="number">2</span><span class="operator">,</span> <span class="variable">e</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">,</span> <span class="variable">e</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="variable">f</span><span class="punctuation">[</span><span class="number">2</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="number">2</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>例子</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">L</span> <span class="operator">=</span> <span class="punctuation">&#123;</span><span class="variable">a</span><span class="operator">,</span> <span class="variable">b</span><span class="operator">,</span> <span class="variable">c</span><span class="operator">,</span> <span class="variable">d</span><span class="punctuation">&#125;</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">MapIndexed</span><span class="punctuation">[</span></span><br><span class="line"> <span class="built_in">Print</span><span class="punctuation">[</span><span class="string">&quot;The position of &quot;</span><span class="operator">,</span> <span class="type">#1</span><span class="operator">,</span> <span class="string">&quot; in the List &quot;</span><span class="operator">,</span> <span class="string">&quot; is &quot;</span><span class="operator">,</span> <span class="type">#2</span><span class="punctuation">[</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="operator">,</span> </span><br><span class="line">   <span class="string">&quot;.&quot;</span><span class="punctuation">]</span> <span class="operator">&amp;,</span> <span class="variable">L</span></span><br><span class="line"> <span class="punctuation">]</span></span><br><span class="line"> <span class="operator">&gt;</span> <span class="variable">The</span> <span class="variable">position</span> <span class="variable">of</span> <span class="variable">a</span> <span class="variable">in</span> <span class="variable">the</span> <span class="built_in">List</span>  <span class="variable">is</span> <span class="number">1.</span></span><br><span class="line"> <span class="operator">&gt;</span> <span class="variable">The</span> <span class="variable">position</span> <span class="variable">of</span> <span class="variable">b</span> <span class="variable">in</span> <span class="variable">the</span> <span class="built_in">List</span>  <span class="variable">is</span> <span class="number">2.</span></span><br><span class="line"> <span class="operator">&gt;</span> <span class="variable">The</span> <span class="variable">position</span> <span class="variable">of</span> <span class="variable">c</span> <span class="variable">in</span> <span class="variable">the</span> <span class="built_in">List</span>  <span class="variable">is</span> <span class="number">3.</span></span><br><span class="line"> <span class="operator">&gt;</span> <span class="variable">The</span> <span class="variable">position</span> <span class="variable">of</span> <span class="variable">d</span> <span class="variable">in</span> <span class="variable">the</span> <span class="built_in">List</span>  <span class="variable">is</span> <span class="number">4.</span></span><br></pre></td></tr></table></figure>
<p>其中<code>#1</code>表示函数的第一个参数，<code>#2</code>表示第二个参数。</p>
<p><code>MapThread</code>函数：</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">MapThread</span><span class="punctuation">[</span><span class="variable">f</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="punctuation">&#123;</span><span class="variable">a</span><span class="operator">,</span> <span class="variable">b</span><span class="operator">,</span> <span class="variable">c</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="variable">p</span><span class="operator">,</span> <span class="variable">q</span><span class="operator">,</span> <span class="variable">r</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="variable">x</span><span class="operator">,</span> <span class="variable">y</span><span class="operator">,</span> <span class="variable">z</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="comment">(*注意每一个列表必须同样大小*)</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="variable">f</span><span class="punctuation">[</span><span class="variable">a</span><span class="operator">,</span> <span class="variable">p</span><span class="operator">,</span> <span class="variable">x</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">b</span><span class="operator">,</span> <span class="variable">q</span><span class="operator">,</span> <span class="variable">y</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">c</span><span class="operator">,</span> <span class="variable">r</span><span class="operator">,</span> <span class="variable">z</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>我们也可以用已有的函数实现：<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">f</span> <span class="operator">@@@</span> <span class="built_in">Transpose</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="punctuation">&#123;</span><span class="variable">a</span><span class="operator">,</span> <span class="variable">b</span><span class="operator">,</span> <span class="variable">c</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="variable">p</span><span class="operator">,</span> <span class="variable">q</span><span class="operator">,</span> <span class="variable">r</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="variable">u</span><span class="operator">,</span> <span class="variable">v</span><span class="operator">,</span> <span class="variable">w</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="variable">f</span><span class="punctuation">[</span><span class="variable">a</span><span class="operator">,</span> <span class="variable">p</span><span class="operator">,</span> <span class="variable">u</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">b</span><span class="operator">,</span> <span class="variable">q</span><span class="operator">,</span> <span class="variable">v</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">c</span><span class="operator">,</span> <span class="variable">r</span><span class="operator">,</span> <span class="variable">w</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><br>Scan函数也有类似于Map函数的用法，但是存在一点不同：<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Scan</span><span class="punctuation">[</span><span class="built_in">Print</span><span class="punctuation">[</span><span class="string">&quot;Hey! I&#x27;m &quot;</span><span class="operator">,</span> <span class="type">#</span><span class="punctuation">]</span> <span class="operator">&amp;,</span> <span class="punctuation">&#123;</span><span class="variable">a</span><span class="operator">,</span> <span class="variable">b</span><span class="operator">,</span> <span class="variable">c</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">Hey</span><span class="operator">!</span> <span class="built_in">I</span><span class="operator">&#x27;</span><span class="variable">m</span> <span class="variable">a</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">Hey</span><span class="operator">!</span> <span class="built_in">I</span><span class="operator">&#x27;</span><span class="variable">m</span> <span class="variable">b</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">Hey</span><span class="operator">!</span> <span class="built_in">I</span><span class="operator">&#x27;</span><span class="variable">m</span> <span class="variable">c</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Map</span><span class="punctuation">[</span><span class="built_in">Print</span><span class="punctuation">[</span><span class="string">&quot;Hey! I&#x27;m &quot;</span><span class="operator">,</span> <span class="type">#</span><span class="punctuation">]</span> <span class="operator">&amp;,</span> <span class="punctuation">&#123;</span><span class="variable">a</span><span class="operator">,</span> <span class="variable">b</span><span class="operator">,</span> <span class="variable">c</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">Hey</span><span class="operator">!</span> <span class="built_in">I</span><span class="operator">&#x27;</span><span class="variable">m</span> <span class="variable">a</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">Hey</span><span class="operator">!</span> <span class="built_in">I</span><span class="operator">&#x27;</span><span class="variable">m</span> <span class="variable">b</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">Hey</span><span class="operator">!</span> <span class="built_in">I</span><span class="operator">&#x27;</span><span class="variable">m</span> <span class="variable">c</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="built_in">Null</span><span class="operator">,</span> <span class="built_in">Null</span><span class="operator">,</span> <span class="built_in">Null</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><br>Scan不关心中间的返回值。<br>Through函数：<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Through</span><span class="punctuation">[</span><span class="punctuation">(</span><span class="variable">f</span> <span class="operator">+</span> <span class="variable">g</span> <span class="operator">+</span> <span class="variable">h</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">,</span> <span class="variable">y</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">Through</span><span class="punctuation">[</span><span class="variable">f</span><span class="punctuation">[</span><span class="variable">g</span><span class="operator">,</span> <span class="variable">h</span><span class="punctuation">]</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">,</span> <span class="variable">y</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">,</span> <span class="variable">y</span><span class="punctuation">]</span> <span class="operator">+</span> <span class="variable">g</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">,</span> <span class="variable">y</span><span class="punctuation">]</span> <span class="operator">+</span> <span class="variable">h</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">,</span> <span class="variable">y</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">g</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">,</span> <span class="variable">y</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">h</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">,</span> <span class="variable">y</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure></p>
<h4 id="函数迭代"><a href="#函数迭代" class="headerlink" title="函数迭代"></a>函数迭代</h4><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Nest</span><span class="punctuation">[</span><span class="variable">f</span><span class="operator">,</span> <span class="variable">x</span><span class="operator">,</span> <span class="number">3</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">NestList</span><span class="punctuation">[</span><span class="variable">f</span><span class="operator">,</span> <span class="variable">x</span><span class="operator">,</span> <span class="number">3</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">f</span><span class="punctuation">[</span><span class="variable">f</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="variable">x</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">f</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">f</span><span class="punctuation">[</span><span class="variable">f</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="函数不动点"><a href="#函数不动点" class="headerlink" title="函数不动点"></a>函数不动点</h4><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">f</span><span class="punctuation">[</span><span class="type">x_</span><span class="punctuation">]</span> <span class="operator">:=</span> <span class="built_in">N</span><span class="punctuation">[</span><span class="punctuation">(</span><span class="variable">x</span> <span class="operator">+</span> <span class="number">2</span><span class="operator">/</span><span class="variable">x</span><span class="punctuation">)</span><span class="operator">/</span><span class="number">2</span><span class="operator">,</span> <span class="number">20</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">FixedPoint</span><span class="punctuation">[</span><span class="variable">f</span><span class="operator">,</span> <span class="number">1</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="number">1.4142135623730950488</span></span><br><span class="line"><span class="built_in">FixedPointList</span><span class="punctuation">[</span><span class="variable">f</span><span class="operator">,</span> <span class="number">1</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="number">1</span><span class="operator">,</span> <span class="number">1.5000000000000000000</span><span class="operator">,</span> <span class="number">1.4166666666666666667</span><span class="operator">,</span> \</span><br><span class="line"><span class="number">1.4142156862745098039</span><span class="operator">,</span> <span class="number">1.4142135623746899106</span><span class="operator">,</span> <span class="number">1.4142135623730950488</span><span class="operator">,</span> \</span><br><span class="line"><span class="number">1.4142135623730950488</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="条件迭代"><a href="#条件迭代" class="headerlink" title="条件迭代"></a>条件迭代</h4><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NestWhile</span><span class="punctuation">[</span><span class="type">#</span><span class="operator">^</span><span class="number">2</span> <span class="operator">&amp;,</span> <span class="number">2</span><span class="operator">,</span> <span class="punctuation">(</span><span class="type">#</span> <span class="operator">&lt;</span> <span class="number">10</span><span class="operator">^</span><span class="number">10</span><span class="punctuation">)</span> <span class="operator">&amp;</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">NestWhileList</span><span class="punctuation">[</span><span class="type">#</span><span class="operator">^</span><span class="number">2</span> <span class="operator">&amp;,</span> <span class="number">2</span><span class="operator">,</span> <span class="punctuation">(</span><span class="type">#</span> <span class="operator">&lt;</span> <span class="number">10</span><span class="operator">^</span><span class="number">10</span><span class="punctuation">)</span> <span class="operator">&amp;</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="number">18446744073709551616</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="number">2</span><span class="operator">,</span> <span class="number">4</span><span class="operator">,</span> <span class="number">16</span><span class="operator">,</span> <span class="number">256</span><span class="operator">,</span> <span class="number">65536</span><span class="operator">,</span> <span class="number">4294967296</span><span class="operator">,</span> <span class="number">18446744073709551616</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>条件迭代也可以用于求解不动点<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">f</span><span class="punctuation">[</span><span class="type">x_</span><span class="punctuation">]</span> <span class="operator">:=</span> <span class="built_in">N</span><span class="punctuation">[</span><span class="punctuation">(</span><span class="variable">x</span> <span class="operator">+</span> <span class="number">3</span><span class="operator">/</span><span class="variable">x</span><span class="punctuation">)</span><span class="operator">/</span><span class="number">2</span><span class="operator">,</span> <span class="number">20</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">NestWhile</span><span class="punctuation">[</span><span class="variable">f</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="built_in">Unequal</span><span class="operator">,</span> <span class="number">2</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="number">1.7320508075688772935</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NestWhileList</span><span class="punctuation">[</span><span class="built_in">Mod</span><span class="punctuation">[</span><span class="number">3</span> <span class="type">#</span><span class="operator">,</span> <span class="number">57</span><span class="punctuation">]</span> <span class="operator">&amp;,</span> <span class="number">1</span><span class="operator">,</span> <span class="built_in">Unequal</span><span class="operator">,</span> <span class="built_in">All</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="number">1</span><span class="operator">,</span> <span class="number">3</span><span class="operator">,</span> <span class="number">9</span><span class="operator">,</span> <span class="number">27</span><span class="operator">,</span> <span class="number">24</span><span class="operator">,</span> <span class="number">15</span><span class="operator">,</span> <span class="number">45</span><span class="operator">,</span> <span class="number">21</span><span class="operator">,</span> <span class="number">6</span><span class="operator">,</span> <span class="number">18</span><span class="operator">,</span> <span class="number">54</span><span class="operator">,</span> <span class="number">48</span><span class="operator">,</span> <span class="number">30</span><span class="operator">,</span> <span class="number">33</span><span class="operator">,</span> <span class="number">42</span><span class="operator">,</span> <span class="number">12</span><span class="operator">,</span> <span class="number">36</span><span class="operator">,</span> <span class="number">51</span><span class="operator">,</span> \</span><br><span class="line"><span class="number">39</span><span class="operator">,</span> <span class="number">3</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="折叠运算"><a href="#折叠运算" class="headerlink" title="折叠运算"></a>折叠运算</h4><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Fold</span><span class="punctuation">[</span><span class="variable">f</span><span class="operator">,</span> <span class="variable">x</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="variable">a</span><span class="operator">,</span> <span class="variable">b</span><span class="operator">,</span> <span class="variable">c</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">FoldList</span><span class="punctuation">[</span><span class="variable">f</span><span class="operator">,</span> <span class="variable">x</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="variable">a</span><span class="operator">,</span> <span class="variable">b</span><span class="operator">,</span> <span class="variable">c</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">f</span><span class="punctuation">[</span><span class="variable">f</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">,</span> <span class="variable">a</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">b</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">c</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">x</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">,</span> <span class="variable">a</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">f</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">,</span> <span class="variable">a</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">b</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">f</span><span class="punctuation">[</span><span class="variable">f</span><span class="punctuation">[</span><span class="variable">f</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">,</span> <span class="variable">a</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">b</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">c</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="第六周"><a href="#第六周" class="headerlink" title="第六周"></a>第六周</h2><h3 id="模块化、语境和包"><a href="#模块化、语境和包" class="headerlink" title="模块化、语境和包"></a>模块化、语境和包</h3><p>在Mathematica中，变量默认为全局变量。这是因为大多数Mathematica程序都比较短小，因此只要靠用户自己维护就可以避免全局变量重名带来的各种问题。但是有些时候人们也需要编制大型的Mathematica程序，这时候就需要将一些全局变量隔离、打包的机制，这就是今天要将的模块化、语境和包等概念。<br>模块化：Module<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">y</span> <span class="operator">=</span> <span class="number">3</span><span class="operator">;</span></span><br><span class="line"><span class="variable">f</span><span class="punctuation">[</span><span class="type">x_</span><span class="punctuation">]</span> <span class="operator">:=</span> <span class="built_in">Module</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="variable">y</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="variable">y</span> <span class="operator">=</span> <span class="variable">x</span> <span class="operator">+</span> <span class="number">1</span><span class="operator">;</span> <span class="variable">x</span><span class="operator">/</span><span class="variable">y</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="variable">f</span><span class="punctuation">[</span><span class="number">10</span><span class="punctuation">]</span></span><br><span class="line"><span class="variable">y</span></span><br><span class="line"></span><br><span class="line"><span class="number">10</span><span class="operator">/</span><span class="number">11</span></span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure><br>Module的作用是定义一个封闭的环境。其中存在一些局部变量(由第一个参数(必须是一个表)的元素组成)。当Module表达式求值完毕之后，这个环境就不存在了，其中的局部变量自然也会消失。<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">print</span> <span class="operator">:=</span> <span class="built_in">Module</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="variable">y</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="variable">y</span><span class="punctuation">]</span></span><br><span class="line"><span class="variable">print</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">y$14115</span></span><br></pre></td></tr></table></figure><br>在Module中，局部变量<code>y</code>被替换为带有内部编号的一种变量<code>y$num</code>，其中<code>num</code>是一个自然数，取自Mathematica内部的一个计数变量<script type="math/tex">ModuleNumber`。每次调用Module或者具有类似功能的结构时都会增加`$ModuleNumber`，于是`y</script>后面的数字永远不相同，所以也就不会有重名问题。<br>我们可以用<code>Unique</code>生成计数器：<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">y</span> <span class="operator">=</span> <span class="built_in">Unique</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span></span><br><span class="line"><span class="variable">y</span> <span class="operator">=</span> <span class="built_in">Unique</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span></span><br><span class="line"><span class="variable">y</span> <span class="operator">=</span> <span class="built_in">Unique</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="variable">x$14690</span></span><br><span class="line"><span class="variable">x$14691</span></span><br><span class="line"><span class="variable">x$14692</span></span><br></pre></td></tr></table></figure><br>注意，带<code>$</code>和编号的变量具有Temporary属性：<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Module</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="variable">x</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="built_in">Print</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">,</span> <span class="string">&quot; has attributes &quot;</span><span class="operator">,</span> <span class="built_in">Attributes</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">x$15746</span> <span class="variable">has</span> <span class="variable">attributes</span> <span class="punctuation">&#123;</span><span class="built_in">Temporary</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><br>我们可以使用<code>?x*</code>来查看<code>x</code>的临时属性。<br>带有临时属性的变量在生存期结束时就会被系统<code>Remove</code>，除非它们生存期内被显式地返回给外部的全局环境。<br>我们下面考察以下另一种结构<code>with</code>来与<code>Module</code>做一下对比：<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">With</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="variable">n</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="built_in">Print</span><span class="punctuation">[</span><span class="variable">n</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">With</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="variable">n</span> <span class="operator">=</span> <span class="number">5</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="built_in">Print</span><span class="punctuation">[</span><span class="variable">n</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">With</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="variable">n</span> <span class="operator">=</span> <span class="variable">a</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="built_in">Print</span><span class="punctuation">[</span><span class="variable">n</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">With</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="variable">n</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="built_in">Print</span><span class="punctuation">[</span><span class="variable">n</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="number">5</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">a</span></span><br></pre></td></tr></table></figure><br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">With</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="variable">n</span> <span class="operator">=</span> <span class="number">5</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">4</span><span class="operator">;</span> <span class="built_in">Print</span><span class="punctuation">[</span><span class="variable">n</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="comment">(*打印5，警告，n不能再被赋值了*)</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span><span class="variable">n</span> <span class="operator">=</span> <span class="number">4</span><span class="operator">;</span> <span class="built_in">Print</span><span class="punctuation">[</span><span class="variable">n</span><span class="punctuation">]</span><span class="punctuation">&#125;</span> <span class="operator">/.</span> <span class="punctuation">&#123;</span><span class="variable">n</span> <span class="operator">-&gt;</span> <span class="number">5</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="number">4</span></span><br><span class="line"><span class="comment">(* 因为是先打印，再替换，所以打印出的是4 *)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">ReleaseHold</span><span class="punctuation">[</span><span class="built_in">Hold</span><span class="punctuation">[</span><span class="punctuation">(</span><span class="variable">n</span> <span class="operator">=</span> <span class="number">4</span><span class="operator">;</span> <span class="built_in">Print</span><span class="punctuation">[</span><span class="variable">n</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">]</span> <span class="operator">/.</span> <span class="punctuation">&#123;</span><span class="variable">n</span> <span class="operator">-&gt;</span> <span class="number">5</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="number">5</span></span><br><span class="line"><span class="comment">(*首先先将(n = 4; Print[n]) hold住，使其变为一个表达式而不执行，替换完成后释放hold执行*)</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">With</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="variable">n</span> <span class="operator">=</span> <span class="number">5</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="built_in">Print</span><span class="punctuation">[</span><span class="variable">n</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">Print</span><span class="punctuation">[</span><span class="variable">n</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="number">5</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">n</span></span><br></pre></td></tr></table></figure>
<p>With的作用是定义一个封闭的环境，其中存在一些局部变量。在With的第二个参数表达式中所有这些常量都会直接替换成第一个参数中赋值语句右边的值。在这个环境中，局部常量的值是不变的。<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">a</span> <span class="operator">=</span> <span class="variable">x</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">With</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="variable">n</span> <span class="operator">=</span> <span class="variable">a</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="variable">n</span> <span class="operator">=</span> <span class="variable">b</span><span class="operator">;</span> <span class="built_in">Print</span><span class="punctuation">[</span><span class="variable">n</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="variable">a</span></span><br><span class="line"><span class="variable">x</span></span><br><span class="line"><span class="variable">b</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">b</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">b</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">b</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">b</span></span><br></pre></td></tr></table></figure><br>注意，在这个例子中，<code>a</code>是一个外部环境的变量，Mathematica的变量实际上都是指针。所以，在With内部，n是与a相等的指针，当我们写n=b时，实际上是在写a=b，它的作用是把a的值换成b的值，n和a始终始终是指向同一个地方，所以”n”仍是常量。<br>但是如果变成<code>n=1;n=b</code>就会警告，因为如果<code>n=1</code>，那么我们就无法将常量<code>1</code>赋值为其他的值。<br>Module和With的内部环境叫做相应的局部变量或局部变量的作用域。下面我们看几种隐式出现的作用域：<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">f</span> <span class="operator">=</span> <span class="built_in">Function</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">,</span> <span class="built_in">Function</span><span class="punctuation">[</span><span class="variable">y</span><span class="operator">,</span> <span class="variable">x</span> <span class="operator">+</span> <span class="variable">y</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="variable">f</span><span class="punctuation">[</span><span class="variable">y</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">Function</span><span class="punctuation">[</span><span class="variable">y$</span><span class="operator">,</span> <span class="variable">y</span> <span class="operator">+</span> <span class="variable">y$</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><br>在这个例子中，<code>f</code>的函数体部分因为某种外部原因，这是Mathematica就会把内层的变量<code>y</code>自动命名为<code>y$</code>，这是一个临时变量，他会在函数定义结束后被销毁。另一个自动改名的例子：<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">With</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="variable">w</span> <span class="operator">=</span> <span class="variable">x</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="variable">h</span><span class="punctuation">[</span><span class="type">x_</span><span class="punctuation">]</span> <span class="operator">:&gt;</span> <span class="variable">w</span> <span class="operator">+</span> <span class="variable">x</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="variable">h</span><span class="punctuation">[</span><span class="type">x$_</span><span class="punctuation">]</span> <span class="operator">:&gt;</span> <span class="variable">x</span> <span class="operator">+</span> <span class="variable">x$</span></span><br></pre></td></tr></table></figure><br>Function定义的是纯函数，或者叫匿名函数、$\lambda-$表达式，它们的参数是所谓的哑变量，可以随意换名字而不影响定义。Mathematica在这里做的正是这样一件事，其原因是为了避免与可能存在的全局变量重名。<br>除了Module、With、Function以外，各种赋值，规则中的模式名称(x_、x__、x:pattern)也具有自动改名的功能，这些赋值、规则语句就成为这些改名后的临时变量的作用域。注意，常量是不能自动改名的。<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">x</span> <span class="operator">=</span>  <span class="number">1</span><span class="operator">;</span> <span class="variable">y</span> <span class="operator">=</span> <span class="variable">a</span><span class="operator">;</span> <span class="variable">f</span><span class="punctuation">[</span><span class="type">x_</span><span class="punctuation">]</span> <span class="operator">:=</span> <span class="punctuation">(</span><span class="variable">x</span> <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span><span class="operator">;</span> <span class="variable">g</span><span class="punctuation">[</span><span class="type">y_</span><span class="punctuation">]</span> <span class="operator">:=</span> <span class="punctuation">(</span><span class="variable">y</span> <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span><span class="operator">;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="variable">f</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">g</span><span class="punctuation">[</span><span class="variable">y</span><span class="punctuation">]</span><span class="operator">,</span> <span class="variable">x</span><span class="operator">,</span> <span class="variable">y</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="number">2</span><span class="operator">,</span><span class="number">2</span><span class="operator">,</span><span class="number">1</span><span class="operator">,</span><span class="number">2</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment">(*第一个居于报错，因为我们想赋值1=2*)</span></span><br></pre></td></tr></table></figure><br>再看一些哑变量的例子：<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">i</span> <span class="operator">=</span> <span class="number">50</span><span class="operator">;</span> <span class="variable">x</span> <span class="operator">=</span> <span class="variable">a</span><span class="operator">;</span><span class="comment">(*此例子中x必须是变量，不能是常数，否则不能做积分变量*)</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="built_in">Sum</span><span class="punctuation">[</span><span class="variable">i</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="variable">i</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="number">100</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="operator">,</span> <span class="built_in">Integrate</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="variable">x</span><span class="operator">,</span> <span class="number">0</span><span class="operator">,</span> <span class="number">1</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="variable">i</span><span class="operator">,</span> <span class="variable">x</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="number">5050</span><span class="operator">,</span> <span class="number">1</span><span class="operator">/</span><span class="number">2</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="number">50</span><span class="operator">,</span> <span class="variable">a</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">p</span><span class="punctuation">[</span><span class="type">n_</span><span class="punctuation">]</span> <span class="operator">:=</span> <span class="built_in">Integrate</span><span class="punctuation">[</span><span class="variable">f</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span> <span class="variable">x</span><span class="operator">^</span><span class="variable">n</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="variable">x</span><span class="operator">,</span> <span class="number">0</span><span class="operator">,</span> <span class="number">1</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="variable">p</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span><span class="comment">(*局部变量与全局变量混淆*)</span></span><br><span class="line"><span class="variable">q</span><span class="punctuation">[</span><span class="type">n_</span><span class="punctuation">]</span> <span class="operator">:=</span> <span class="built_in">Module</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="variable">x</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="built_in">Integrate</span><span class="punctuation">[</span><span class="variable">f</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span> <span class="variable">x</span><span class="operator">^</span><span class="variable">n</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="variable">x</span><span class="operator">,</span> <span class="number">0</span><span class="operator">,</span> <span class="number">1</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="variable">q</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure></p>
<p>Module和With都是通过改名的办法将作用域内的变量变为与外部变量不同的局部变量。有的时候我们需要另外一种隔离手段，我们想要构造一个作用域，其中局部变量与全局变量具有相同的”名字”和不同的”值”，这就要用Block来做隔离。<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Module</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="variable">x</span> <span class="operator">=</span> <span class="variable">a</span> <span class="operator">+</span> <span class="number">1</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="variable">x</span><span class="operator">^</span><span class="number">2</span> <span class="operator">+</span> <span class="number">3</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">Block</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="variable">x</span> <span class="operator">=</span> <span class="variable">a</span> <span class="operator">+</span> <span class="number">1</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="variable">x</span><span class="operator">^</span><span class="number">2</span> <span class="operator">+</span> <span class="number">3</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="number">3</span> <span class="operator">+</span> <span class="punctuation">(</span><span class="number">1</span> <span class="operator">+</span> <span class="variable">a</span><span class="punctuation">)</span><span class="operator">^</span><span class="number">2</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="number">3</span> <span class="operator">+</span> <span class="punctuation">(</span><span class="number">1</span> <span class="operator">+</span> <span class="variable">a</span><span class="punctuation">)</span><span class="operator">^</span><span class="number">2</span></span><br></pre></td></tr></table></figure><br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">y</span> <span class="operator">=</span> <span class="variable">x</span><span class="operator">^</span><span class="number">2</span> <span class="operator">+</span> <span class="number">3</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">Module</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="variable">x</span> <span class="operator">=</span> <span class="variable">a</span> <span class="operator">+</span> <span class="number">1</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="variable">y</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">Block</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="variable">x</span> <span class="operator">=</span> <span class="variable">a</span> <span class="operator">+</span> <span class="number">1</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="variable">y</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="number">3</span> <span class="operator">+</span> <span class="variable">x</span><span class="operator">^</span><span class="number">2</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="number">3</span> <span class="operator">+</span> <span class="punctuation">(</span><span class="number">1</span> <span class="operator">+</span> <span class="variable">a</span><span class="punctuation">)</span><span class="operator">^</span><span class="number">2</span></span><br></pre></td></tr></table></figure><br>我们可以换一种角度来解释两者的不同。在上面的例子中，Module里的局部变量只生存在Module内，它不会跟踪y的定义跑出到Module外面去；另一方面，Block里的局部变量x会跟踪出去，找出y中出现的所有x，然后替换，所以它的作用域可以从Block延伸出去，侵入到y的作用域中。上面提到的积分变量必须是变量是因为积分是用<code>Block</code>实现的。</p>
<p>利用这些域规则我们可以创造出很对有趣的函数。<br>闭包的例子：计数器产生器<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">CounterCreator</span><span class="punctuation">[</span><span class="type">first_</span><span class="operator">:</span> <span class="number">1</span><span class="operator">,</span> <span class="type">delta_</span><span class="operator">:</span> <span class="number">1</span><span class="punctuation">]</span> <span class="operator">:=</span> </span><br><span class="line"> <span class="built_in">Module</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="variable">i</span> <span class="operator">=</span> <span class="variable">first</span> <span class="operator">-</span> <span class="variable">delta</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="variable">i</span> <span class="operator">+=</span> <span class="variable">delta</span><span class="punctuation">&#125;</span> <span class="operator">&amp;</span><span class="punctuation">]</span></span><br><span class="line"><span class="variable">counter1</span> <span class="operator">=</span> <span class="variable">CounterCreator</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="variable">counter2</span> <span class="operator">=</span> <span class="variable">CounterCreator</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="variable">counter3</span> <span class="operator">=</span> <span class="variable">CounterCreator</span><span class="punctuation">[</span><span class="number">19</span><span class="operator">,</span> <span class="number">2</span><span class="punctuation">]</span><span class="operator">;</span></span><br></pre></td></tr></table></figure><br>这样就创建了三个计数器，各个计数器之间互不干扰。<br>另一个闭包的例子，状态机：<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">StateMachine</span> <span class="operator">=</span> </span><br><span class="line">  <span class="built_in">Module</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="variable">i</span><span class="punctuation">&#125;</span><span class="operator">,</span> </span><br><span class="line">   <span class="built_in">Function</span><span class="punctuation">[</span><span class="variable">func</span><span class="operator">,</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span><span class="operator">;</span> </span><br><span class="line">    <span class="built_in">Switch</span><span class="punctuation">[</span><span class="variable">func</span><span class="operator">,</span> <span class="number">0</span><span class="operator">,</span> <span class="variable">i</span> <span class="operator">&amp;,</span> <span class="number">1</span><span class="operator">,</span> <span class="operator">++</span><span class="variable">i</span> <span class="operator">&amp;,</span> <span class="number">2</span><span class="operator">,</span> <span class="operator">--</span><span class="variable">i</span> <span class="operator">&amp;,</span> <span class="number">3</span><span class="operator">,</span> <span class="punctuation">(</span><span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span> <span class="operator">&amp;,</span> <span class="type">_</span><span class="operator">,</span> </span><br><span class="line">     <span class="built_in">Print</span><span class="punctuation">[</span><span class="string">&quot;Illegal function!&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"> </span><br><span class="line"><span class="variable">read</span> <span class="operator">=</span> <span class="variable">StateMachine</span><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="variable">up</span> <span class="operator">=</span> <span class="variable">StateMachine</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="variable">down</span> <span class="operator">=</span> <span class="variable">StateMachine</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="variable">reset</span> <span class="operator">=</span> <span class="variable">StateMachine</span><span class="punctuation">[</span><span class="number">3</span><span class="punctuation">]</span><span class="operator">;</span></span><br></pre></td></tr></table></figure><br>这四个相互影响。<br>在各种程序语言中，还有一种显式指定作用域的方法。典型的例子就是C++语言中的命名空间(namespace)。在Mathematica中也有一种类似的机制，叫做语境(Context)。<br>Global`是Mathematica的默认语境，所有用户自己定义的符号、函数都存在于这个语境中。用户也可以自己定义语境：<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">foo</span><span class="operator">`</span><span class="variable">x</span> <span class="operator">=</span> <span class="number">2</span><span class="operator">;</span></span><br><span class="line"><span class="comment">(*语境也可以嵌套*)</span></span><br><span class="line"><span class="variable">foo</span><span class="operator">`</span><span class="variable">bar</span><span class="operator">`</span><span class="variable">x</span> <span class="operator">=</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><br>语境就像是文件系统中的文件夹，语境下面的嵌套语境就像文件夹下的子文件夹。语境中的符号、函数则像文件夹中的各种文件。无论如何，我们在Mathematica中总存在于一个语境中，它可以通过变量<code>$Context</code>访问。<br>如果Mathematica遇到一个符号，他首先会在当前语境中查找这个符号的意义。如果找不到，则会在<code>$ContextPath</code>所指定语境路径按顺序查找这个符号。<br>我们可以通过赋值改变当前语境，也可以向语境路径中添加我们的语境：<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$Context</span> <span class="operator">=</span> <span class="string">&quot;foo`&quot;</span></span><br><span class="line"><span class="built_in">$ContextPath</span> <span class="operator">=</span> <span class="built_in">PrependTo</span><span class="punctuation">[</span><span class="built_in">$ContextPath</span><span class="operator">,</span> <span class="string">&quot;bar&quot;</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><br>函数<code>Context[]</code>可以查找当前语境或者某个符号所属的语境：<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Context</span><span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">Context</span><span class="punctuation">[</span><span class="variable">x</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><br>函数<code>Contexts</code>可以列出所有的语境，或者按通配符列出相应的语境：<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Contexts</span><span class="punctuation">[</span><span class="string">&quot;System`**&quot;</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><br>语境可以通过<code>Begin[&quot;Content&quot;]</code>和<code>End[]</code>进出：<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Begin</span><span class="punctuation">[</span><span class="string">&quot;新语境&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">Print</span><span class="punctuation">[</span><span class="variable">x</span><span class="operator">=</span><span class="number">1</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">End</span><span class="punctuation">[</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><br>我们后面介绍包(package)的概念、包都自带一个语境。如果导入了某个程序包，那么它的语境会自动添加为语境路径的第一个语境。<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Needs</span><span class="punctuation">[</span><span class="string">&quot;Quaternions&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">$ContextPath</span></span><br></pre></td></tr></table></figure></p>
<h2 id="第七周"><a href="#第七周" class="headerlink" title="第七周"></a>第七周</h2><h3 id="优化技术"><a href="#优化技术" class="headerlink" title="优化技术"></a>优化技术</h3><p>要谈优化，首先要有测量：<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Timing</span><span class="punctuation">[</span><span class="built_in">FactorInteger</span><span class="punctuation">[</span><span class="number">2</span><span class="operator">^</span><span class="punctuation">(</span><span class="number">2</span><span class="operator">^</span><span class="number">8</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">AbsoluteTiming</span><span class="punctuation">[</span><span class="built_in">FactorInteger</span><span class="punctuation">[</span><span class="number">2</span><span class="operator">^</span><span class="punctuation">(</span><span class="number">2</span><span class="operator">^</span><span class="number">8</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span><span class="number">0.359375</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="punctuation">&#123;</span><span class="number">1238926361552897</span><span class="operator">,</span> </span><br><span class="line">   <span class="number">1</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="number">93461639715357977769163558199606896584051237541638188580280321</span>\</span><br><span class="line"><span class="operator">,</span> <span class="number">1</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span><span class="number">0.365291</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="punctuation">&#123;</span><span class="number">1238926361552897</span><span class="operator">,</span> </span><br><span class="line">   <span class="number">1</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="number">93461639715357977769163558199606896584051237541638188580280321</span>\</span><br><span class="line"><span class="operator">,</span> <span class="number">1</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><br>还有空间的度量<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">pts</span> <span class="operator">=</span> <span class="built_in">RandomReal</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="number">10000</span><span class="operator">,</span> <span class="number">2</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="variable">gr</span> <span class="operator">=</span> <span class="built_in">Graphics</span><span class="punctuation">[</span><span class="built_in">Point</span> <span class="operator">/@</span> <span class="variable">pts</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="variable">grMulti</span> <span class="operator">=</span> <span class="built_in">Graphics</span><span class="punctuation">[</span><span class="built_in">Point</span><span class="punctuation">[</span><span class="variable">pts</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">ByteCount</span> <span class="operator">/@</span> <span class="punctuation">&#123;</span><span class="variable">gr</span><span class="operator">,</span> <span class="variable">grMulti</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span><span class="number">1760128</span><span class="operator">,</span> <span class="number">160248</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><br>除此之外，还有<code>MemoryInUse</code>等。<br>我们主要关心对时间的优化，有以下几条大的原则：</p>
<ol>
<li>不要重复造轮子，尽量用Mathematica自己的函数。</li>
<li>不要自己写循环：要尽可能地将循环都转为表处理。</li>
<li>要善于用数学。</li>
<li>知道得越多，算得越快。</li>
<li>简单比复杂好</li>
<li>纯函数比模式匹配快<h3 id="字符串处理"><a href="#字符串处理" class="headerlink" title="字符串处理"></a>字符串处理</h3><code>StringLength</code>获取字符串长度、<code>StringJoin</code>连接字符串。<code>&lt;&gt;</code>字符串连接。<br><code>CharacterRange[&quot;a&quot;,&quot;z&quot;]</code>：生成从”a”到”z”的ASSIC码。<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">alphabet</span> <span class="operator">=</span> <span class="built_in">StringJoin</span><span class="punctuation">[</span><span class="built_in">CharacterRange</span><span class="punctuation">[</span><span class="string">&quot;a&quot;</span><span class="operator">,</span> <span class="string">&quot;z&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">StringTake</span><span class="punctuation">[</span><span class="variable">alphabet</span><span class="operator">,</span> <span class="number">12</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">StringDrop</span><span class="punctuation">[</span><span class="variable">alphabet</span><span class="operator">,</span> <span class="number">12</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">StringPart</span><span class="punctuation">[</span><span class="variable">alphabet</span><span class="operator">,</span> <span class="number">12</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">StringTake</span><span class="punctuation">[</span><span class="variable">alphabet</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="number">12</span><span class="operator">,</span> <span class="number">16</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">StringTake</span><span class="punctuation">[</span><span class="variable">alphabet</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="number">12</span> <span class="operator">;;</span> <span class="number">16</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
字符串模式：<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">MatchQ</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="variable">a</span><span class="operator">,</span> <span class="variable">b</span><span class="operator">,</span> <span class="variable">c</span><span class="operator">,</span> <span class="variable">d</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="type">___</span><span class="operator">,</span> <span class="type">x_</span><span class="operator">,</span> <span class="type">x_</span><span class="operator">,</span> <span class="type">___</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">MatchQ</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="variable">a</span><span class="operator">,</span> <span class="variable">b</span><span class="operator">,</span> <span class="variable">c</span><span class="operator">,</span> <span class="variable">c</span><span class="operator">,</span> <span class="variable">d</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="type">___</span><span class="operator">,</span> <span class="type">x_</span><span class="operator">,</span> <span class="type">x_</span><span class="operator">,</span> <span class="type">___</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">StringMatchQ</span><span class="punctuation">[</span><span class="string">&quot;abcd&quot;</span><span class="operator">,</span> <span class="type">___</span> <span class="operator">~~</span> <span class="type">x_</span> <span class="operator">~~</span> <span class="type">x_</span> <span class="operator">~~</span> <span class="type">___</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">StringMatchQ</span><span class="punctuation">[</span><span class="string">&quot;abccd&quot;</span><span class="operator">,</span> <span class="type">___</span> <span class="operator">~~</span> <span class="type">x_</span> <span class="operator">~~</span> <span class="type">x_</span> <span class="operator">~~</span> <span class="type">___</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">StringFreeQ</span><span class="punctuation">[</span><span class="string">&quot;aabbccdd&quot;</span><span class="operator">,</span> <span class="string">&quot;bc&quot;</span> <span class="operator">~~</span> <span class="type">x_</span> <span class="operator">~~</span> <span class="string">&quot;d&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">StringCases</span><span class="punctuation">[</span><span class="string">&quot;aabbccdd&quot;</span><span class="operator">,</span> <span class="type">x_</span> <span class="operator">~~</span> <span class="type">x_</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">StringCases</span><span class="punctuation">[</span><span class="string">&quot;aabbccdd&quot;</span><span class="operator">,</span> <span class="type">x_</span> <span class="operator">~~</span> <span class="type">x_</span> <span class="operator">:&gt;</span> <span class="variable">x</span> <span class="operator">&lt;&gt;</span> <span class="variable">x</span> <span class="operator">&lt;&gt;</span> <span class="variable">x</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">StringPosition</span><span class="punctuation">[</span><span class="string">&quot;aabbccdd&quot;</span><span class="operator">,</span> <span class="type">x_</span> <span class="operator">~~</span> <span class="type">x_</span> <span class="operator">~~</span> <span class="type">y_</span> <span class="operator">~~</span> <span class="type">y_</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">StringCount</span><span class="punctuation">[</span><span class="string">&quot;abcadcadcbqwertaac&quot;</span><span class="operator">,</span> <span class="string">&quot;a&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">StringCount</span><span class="punctuation">[</span><span class="string">&quot;abcadcadcbqwertaac&quot;</span><span class="operator">,</span> <span class="string">&quot;a&quot;</span> <span class="operator">~~</span> <span class="type">_</span> <span class="operator">~~</span> <span class="string">&quot;c&quot;</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">StringReplace</span><span class="punctuation">[</span><span class="string">&quot;abbaabbaa&quot;</span><span class="operator">,</span> <span class="string">&quot;ab&quot;</span> <span class="operator">-&gt;</span> <span class="string">&quot;X&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">StringReplace</span><span class="punctuation">[</span><span class="string">&quot;ababbabbaaababa&quot;</span><span class="operator">,</span> <span class="string">&quot;ab&quot;</span> <span class="operator">..</span> <span class="operator">-&gt;</span> <span class="string">&quot;X&quot;</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">StringReplaceList</span><span class="punctuation">[</span><span class="string">&quot;ccccc&quot;</span><span class="operator">,</span> <span class="string">&quot;c&quot;</span> <span class="operator">-&gt;</span> <span class="string">&quot;XYX&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">StringReplaceList</span><span class="punctuation">[</span><span class="string">&quot;abcdeabacde&quot;</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="string">&quot;abc&quot;</span> <span class="operator">-&gt;</span> <span class="string">&quot;X&quot;</span><span class="operator">,</span> <span class="string">&quot;cde&quot;</span> <span class="operator">-&gt;</span> <span class="string">&quot;Y&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">StringReplace</span><span class="punctuation">[</span><span class="string">&quot;the cat in the hat&quot;</span><span class="operator">,</span>  </span><br><span class="line"> <span class="built_in">Except</span><span class="punctuation">[</span><span class="built_in">Characters</span><span class="punctuation">[</span><span class="string">&quot;aeiou&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">-&gt;</span> <span class="string">&quot;&quot;</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">StringSplit</span><span class="punctuation">[</span><span class="string">&quot;a bbb cccc aa d&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">StringSplit</span><span class="punctuation">[</span><span class="string">&quot;a----bbb---ccc--dddd&quot;</span><span class="operator">,</span> <span class="string">&quot;--&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">StringSplit</span><span class="punctuation">[</span><span class="string">&quot;a----bbb---ccc--dddd&quot;</span><span class="operator">,</span> <span class="string">&quot;-&quot;</span> <span class="operator">..</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">StringSplit</span><span class="punctuation">[</span><span class="string">&quot;a--.-bbb- -|-ccc--ddd&quot;</span><span class="operator">,</span> <span class="punctuation">(</span><span class="string">&quot;-&quot;</span> <span class="operator">|</span> <span class="string">&quot;.&quot;</span> <span class="operator">|</span> <span class="string">&quot;|&quot;</span> <span class="operator">|</span> <span class="string">&quot; &quot;</span><span class="punctuation">)</span> <span class="operator">..</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<p>字符串的完整形式：<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">FullForm</span><span class="punctuation">[</span><span class="string">&quot;a&quot;</span> <span class="operator">~~</span> <span class="type">_</span> <span class="operator">~~</span> <span class="string">&quot;b&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">FullForm</span><span class="punctuation">[</span><span class="string">&quot;a&quot;</span> <span class="operator">~~</span> <span class="type">__</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">FullForm</span><span class="punctuation">[</span><span class="string">&quot;a&quot;</span> <span class="operator">~~</span> <span class="type">___</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">FullForm</span><span class="punctuation">[</span><span class="string">&quot;a&quot;</span> <span class="operator">..</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">FullForm</span><span class="punctuation">[</span><span class="string">&quot;a&quot;</span> <span class="operator">...</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Repeated</span><span class="punctuation">[</span><span class="string">&quot;a&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">RepeatedNull</span><span class="punctuation">[</span><span class="string">&quot;a&quot;</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<p>其他字符串模式：<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">StringSplit</span><span class="punctuation">[</span><span class="string">&quot;a bbb \t cc \rcc aa \n d&quot;</span><span class="operator">,</span> <span class="built_in">Whitespace</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">StringSplit</span><span class="punctuation">[</span><span class="string">&quot;a384bcibeyu198e7wr&quot;</span><span class="operator">,</span> <span class="built_in">CharacterRange</span><span class="punctuation">[</span><span class="string">&quot;0&quot;</span><span class="operator">,</span> <span class="string">&quot;9&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">StringSplit</span><span class="punctuation">[</span><span class="string">&quot;a384bcibeyu198e7wr&quot;</span><span class="operator">,</span> <span class="built_in">LetterCharacter</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">StringMatchQ</span><span class="punctuation">[</span><span class="string">&quot;abaababb&quot;</span><span class="operator">,</span> <span class="built_in">StartOfString</span> <span class="operator">~~</span> <span class="string">&quot;a&quot;</span> <span class="operator">~~</span> <span class="type">__</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">StringMatchQ</span><span class="punctuation">[</span><span class="string">&quot;abaababb&quot;</span><span class="operator">,</span> <span class="type">__</span> <span class="operator">~~</span> <span class="string">&quot;a&quot;</span> <span class="operator">~~</span> <span class="built_in">EndOfString</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><br>将一般的表达式转换为字符串搜索会提速：<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">test</span> <span class="operator">=</span> <span class="built_in">Range</span><span class="punctuation">[</span><span class="number">1000</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="variable">test</span><span class="punctuation">[</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="number">50</span><span class="operator">,</span> <span class="number">75</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="number">5</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">Position</span><span class="punctuation">[</span><span class="variable">test</span><span class="operator">,</span> <span class="number">5</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">MatchQ</span><span class="punctuation">[</span><span class="variable">test</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="type">___</span><span class="operator">,</span> <span class="type">x_</span><span class="operator">,</span> <span class="type">___</span><span class="operator">,</span> <span class="type">x_</span><span class="operator">,</span> <span class="type">___</span><span class="operator">,</span> <span class="type">x_</span><span class="operator">,</span> <span class="type">___</span><span class="punctuation">&#125;</span><span class="punctuation">]</span> <span class="operator">//</span> <span class="built_in">Timing</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="punctuation">&#123;</span><span class="number">5</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="number">50</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="number">75</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="number">3.71875</span><span class="operator">,</span> <span class="built_in">True</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">teststr</span> <span class="operator">=</span> <span class="built_in">FromCharacterCode</span><span class="punctuation">[</span><span class="variable">test</span><span class="punctuation">]</span><span class="operator">;</span></span><br><span class="line"><span class="built_in">StringPosition</span><span class="punctuation">[</span><span class="variable">teststr</span><span class="operator">,</span> <span class="built_in">FromCharacterCode</span><span class="punctuation">[</span><span class="number">5</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">StringMatchQ</span><span class="punctuation">[</span><span class="variable">teststr</span><span class="operator">,</span> </span><br><span class="line">  <span class="built_in">StringExpression</span><span class="punctuation">[</span><span class="type">___</span><span class="operator">,</span> <span class="type">x_</span><span class="operator">,</span> <span class="type">___</span><span class="operator">,</span> <span class="type">x_</span><span class="operator">,</span> <span class="type">___</span><span class="operator">,</span> <span class="type">x_</span><span class="operator">,</span> <span class="type">___</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">//</span> <span class="built_in">Timing</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="punctuation">&#123;</span><span class="number">5</span><span class="operator">,</span> <span class="number">5</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="number">50</span><span class="operator">,</span> <span class="number">50</span><span class="punctuation">&#125;</span><span class="operator">,</span> <span class="punctuation">&#123;</span><span class="number">75</span><span class="operator">,</span> <span class="number">75</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="punctuation">&#123;</span><span class="number">0.015625</span><span class="operator">,</span> <span class="built_in">True</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></p>

    </div>

    
    
    
	
	
      <div>
       <div>
    
        <div style="text-align:center;color: #ccc;font-size:24px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
      </div>
    
        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="Han Fangcheng 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.jpg" alt="Han Fangcheng 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Han Fangcheng
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://www.hfcouc.work/2022/07/18/math2/" title="B站课程Mathematica剩余部分">https://www.hfcouc.work/2022/07/18/math2/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

        

  <div class="followme">
    <p>欢迎关注我的其它发布渠道</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/images/wechat_channel.png">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E7%BC%96%E7%A8%8B/" rel="tag"># 编程</a>
              <a href="/tags/Mathematica/" rel="tag"># Mathematica</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/07/16/rt5/" rel="prev" title="Statistical Rethinking:Chapter5">
      <i class="fa fa-chevron-left"></i> Statistical Rethinking:Chapter5
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/07/19/alo1/" rel="next" title="算法导论课程第一周">
      算法导论课程第一周 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="lv-container" data-id="city" data-uid="MTAyMC81MzYxNS8zMDA4OA=="></div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>
  <aside class="sidebar">
    <div class="sidebar-inner">
	
      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>
      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E5%9B%9B%E5%91%A8"><span class="nav-number">1.</span> <span class="nav-text">第四周</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E5%86%99%E8%A7%84%E5%88%99"><span class="nav-number">1.1.</span> <span class="nav-text">重写规则</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%BA%94%E5%91%A8"><span class="nav-number">2.</span> <span class="nav-text">第五周</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E4%B8%8E%E6%B3%9B%E5%87%BD%E7%BC%96%E7%A8%8B"><span class="nav-number">2.1.</span> <span class="nav-text">函数与泛函编程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="nav-number">2.1.1.</span> <span class="nav-text">函数的属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0"><span class="nav-number">2.1.2.</span> <span class="nav-text">匿名函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%A6%E4%B8%8B%E6%A0%87%E7%9A%84%E5%87%BD%E6%95%B0"><span class="nav-number">2.1.3.</span> <span class="nav-text">带下标的函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E7%9A%84%E5%87%BD%E6%95%B0"><span class="nav-number">2.1.4.</span> <span class="nav-text">函数的函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%9B%E5%87%BD%E6%93%8D%E4%BD%9C"><span class="nav-number">2.1.5.</span> <span class="nav-text">泛函操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E8%BF%AD%E4%BB%A3"><span class="nav-number">2.1.6.</span> <span class="nav-text">函数迭代</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E4%B8%8D%E5%8A%A8%E7%82%B9"><span class="nav-number">2.1.7.</span> <span class="nav-text">函数不动点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E8%BF%AD%E4%BB%A3"><span class="nav-number">2.1.8.</span> <span class="nav-text">条件迭代</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%98%E5%8F%A0%E8%BF%90%E7%AE%97"><span class="nav-number">2.1.9.</span> <span class="nav-text">折叠运算</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E5%85%AD%E5%91%A8"><span class="nav-number">3.</span> <span class="nav-text">第六周</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E5%8C%96%E3%80%81%E8%AF%AD%E5%A2%83%E5%92%8C%E5%8C%85"><span class="nav-number">3.1.</span> <span class="nav-text">模块化、语境和包</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%83%E5%91%A8"><span class="nav-number">4.</span> <span class="nav-text">第七周</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E6%8A%80%E6%9C%AF"><span class="nav-number">4.1.</span> <span class="nav-text">优化技术</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%84%E7%90%86"><span class="nav-number">4.2.</span> <span class="nav-text">字符串处理</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->
      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Han Fangcheng"
      src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fb-ssl.duitang.com%2Fuploads%2Fitem%2F201805%2F17%2F20180517161524_3KNca.thumb.700_0.jpeg&refer=http%3A%2F%2Fb-ssl.duitang.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1659264207&t=3d15a378d08a1d4a57e3463cdbe4c159">
  <p class="site-author-name" itemprop="name">Han Fangcheng</p>
  <div class="site-description" itemprop="description">当你穿过了暴风雨，你就不再是原来那个人</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">23</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/HFC666" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;HFC666" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/hfc@stu.ouc.edu.cn" title="E-Mail → hfc@stu.ouc.edu.cn"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/bu-yu-que-zhi-xin-43-35" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;bu-yu-que-zhi-xin-43-35" rel="noopener" target="_blank"><i class="fab fa-gratipay fa-fw"></i>知乎</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/qq_44777424" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_44777424" rel="noopener" target="_blank"><i class="fab fa-codiepie fa-fw"></i>CSDN</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      链接网站
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.bilibili.com/" title="https:&#x2F;&#x2F;www.bilibili.com&#x2F;" rel="noopener" target="_blank">哔哩哔哩</a>
        </li>
    </ul>
  </div>

      </div>
	  <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1904321665&auto=1&height=66"></iframe>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; Tue Jul 13 2021 08:00:00 GMT+0800 (GMT+08:00) – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Han Fangcheng</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>


    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">总访客数<span id="busuanzi_value_site_uv"></span>人</span>
    <span class="post-meta-divider">|</span>
<!-- 不蒜子计数初始值纠正 -->
<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var countOffset = 20000;  // 初始化首次数据

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset); // 加上初始数据 
            clearInterval(int); // 停止检测
        }  
    }
       	
});
</script> 

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.3.5/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>



  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

<script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  window.livereOptions = {
    refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>

    <script src="/js/cursor/cherry.js"></script>
